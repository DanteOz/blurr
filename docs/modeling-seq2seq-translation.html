---

title: modeling.seq2seq.translation


keywords: fastai
sidebar: home_sidebar

summary: "This module contains custom models, custom splitters, etc... translation tasks."
description: "This module contains custom models, custom splitters, etc... translation tasks."
nb_path: "nbs/02zc_modeling-seq2seq-translation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/02zc_modeling-seq2seq-translation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[nltk_data] Downloading package wordnet to /home/wgilliam/nltk_data...
[nltk_data]   Package wordnet is already up-to-date!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">set_device</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Using GPU #</span><span class="si">{</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">current_device</span><span class="p">()</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">get_device_name</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Using GPU #1: GeForce GTX 1080 Ti
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Translation">Translation<a class="anchor-link" href="#Translation"> </a></h2><p>Translation tasks attempt to convert text in one language into another</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Prepare-the-data">Prepare the data<a class="anchor-link" href="#Prepare-the-data"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s1">&#39;wmt16&#39;</span><span class="p">,</span> <span class="s1">&#39;de-en&#39;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s1">&#39;train[:1%]&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Reusing dataset wmt16 (/home/wgilliam/.cache/huggingface/datasets/wmt16/de-en/1.0.0/7b2c4443a7d34c2e13df267eaa8cab4c62dd82f6b62b0d9ecc2e3a673ce17308)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)</span>
<span class="n">wmt_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;translation&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;de&#39;</span><span class="p">,</span> <span class="s1">&#39;en&#39;</span><span class="p">]);</span> <span class="nb">len</span><span class="p">(</span><span class="n">wmt_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>45489</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">wmt_df</span> <span class="o">=</span> <span class="n">wmt_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">1000</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">wmt_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>de</th>
      <th>en</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Wiederaufnahme der Sitzungsperiode</td>
      <td>Resumption of the session</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Ich erkläre die am Freitag, dem 17. Dezember unterbrochene Sitzungsperiode des Europäischen Parlaments für wiederaufgenommen, wünsche Ihnen nochmals alles Gute zum Jahreswechsel und hoffe, daß Sie schöne Ferien hatten.</td>
      <td>I declare resumed the session of the European Parliament adjourned on Friday 17 December 1999, and I would like once again to wish you a happy new year in the hope that you enjoyed a pleasant festive period.</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pretrained_model_name</span> <span class="o">=</span> <span class="s2">&quot;facebook/bart-large-cnn&quot;</span>
<span class="n">task</span> <span class="o">=</span> <span class="n">HF_TASKS_AUTO</span><span class="o">.</span><span class="n">Seq2SeqLM</span>

<span class="n">hf_arch</span><span class="p">,</span> <span class="n">hf_config</span><span class="p">,</span> <span class="n">hf_tokenizer</span><span class="p">,</span> <span class="n">hf_model</span> <span class="o">=</span> <span class="n">BLURR_MODEL_HELPER</span><span class="o">.</span><span class="n">get_hf_objects</span><span class="p">(</span><span class="n">pretrained_model_name</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>

<span class="n">hf_arch</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_tokenizer</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_config</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(&#39;bart&#39;,
 transformers.models.bart.tokenization_bart_fast.BartTokenizerFast,
 transformers.models.bart.configuration_bart.BartConfig,
 transformers.models.bart.modeling_bart.BartForConditionalGeneration)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">blocks</span> <span class="o">=</span> <span class="p">(</span><span class="n">HF_Seq2SeqBlock</span><span class="p">(</span><span class="n">hf_arch</span><span class="p">,</span> <span class="n">hf_config</span><span class="p">,</span> <span class="n">hf_tokenizer</span><span class="p">,</span> <span class="n">hf_model</span><span class="p">),</span> <span class="n">noop</span><span class="p">)</span>
<span class="n">dblock</span> <span class="o">=</span> <span class="n">DataBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">,</span> <span class="n">get_x</span><span class="o">=</span><span class="n">ColReader</span><span class="p">(</span><span class="s1">&#39;de&#39;</span><span class="p">),</span> <span class="n">get_y</span><span class="o">=</span><span class="n">ColReader</span><span class="p">(</span><span class="s1">&#39;en&#39;</span><span class="p">),</span> <span class="n">splitter</span><span class="o">=</span><span class="n">RandomSplitter</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span> <span class="o">=</span> <span class="n">dblock</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">wmt_df</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;input_ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(2, torch.Size([2, 325]), torch.Size([2, 107]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span><span class="o">.</span><span class="n">show_batch</span><span class="p">(</span><span class="n">dataloaders</span><span class="o">=</span><span class="n">dls</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">input_trunc_at</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">target_trunc_at</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Angesichts dieser Situation muß aus dem Bericht, den das Parlament annimmt, klar hervorgehen, daß Maßnahmen notwendig sind, die eindeutig auf die Bekämpfung der relativen Armut und der Arbeitslosigkeit gerichtet sind. Maßnahmen wie die für diese Zwe</td>
      <td>Given this situation, the report approved by Parliament must highlight the need for measures that aim unequivocally to fight relative poverty and unemployment: measures such as the appropriate use of structural funds for these purposes, which are of</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Frau Schroedter, Sie haben zu Recht daran erinnert, daß es im wesentlichen Aufgabe der Mitgliedstaaten und der Regionen ist, ihre eigenen Entwicklungsprioritäten festzulegen. Doch aufgrund der Kofinanzierung der Programme durch die Europäische Union</td>
      <td>Mrs Schroedter, you quite rightly pointed out that while it is chiefly up to the Member States and the regions to define their own priorities in development matters, European Union cofinancing of the programmes requires, and is the justification for</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Train-model">Train model<a class="anchor-link" href="#Train-model"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">seq2seq_metrics</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;bleu&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;returns&#39;</span><span class="p">:</span> <span class="s2">&quot;bleu&quot;</span> <span class="p">},</span>
    <span class="s1">&#39;meteor&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;returns&#39;</span><span class="p">:</span> <span class="s2">&quot;meteor&quot;</span> <span class="p">},</span>
    <span class="s1">&#39;sacrebleu&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;returns&#39;</span><span class="p">:</span> <span class="s2">&quot;score&quot;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">HF_BaseModelWrapper</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span>

<span class="n">learn_cbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">HF_BaseModelCallback</span><span class="p">]</span>
<span class="n">fit_cbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">HF_Seq2SeqMetricsCallback</span><span class="p">(</span><span class="n">custom_metrics</span><span class="o">=</span><span class="n">seq2seq_metrics</span><span class="p">)]</span>

<span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> 
                <span class="n">model</span><span class="p">,</span>
                <span class="n">opt_func</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">Adam</span><span class="p">),</span>
                <span class="n">loss_func</span><span class="o">=</span><span class="n">CrossEntropyLossFlat</span><span class="p">(),</span> <span class="c1">#HF_PreCalculatedLoss()</span>
                <span class="n">cbs</span><span class="o">=</span><span class="n">learn_cbs</span><span class="p">,</span>
                <span class="n">splitter</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">seq2seq_splitter</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="n">hf_arch</span><span class="p">))</span> <span class="c1">#.to_native_fp16() #.to_fp16()</span>

<span class="n">learn</span><span class="o">.</span><span class="n">create_opt</span><span class="p">()</span> 
<span class="n">learn</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># preds = learn.model(b[0])</span>

<span class="c1"># len(preds),preds[&#39;loss&#39;].shape, preds[&#39;logits&#39;].shape</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;input_ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(2, 3, torch.Size([2, 325]), 2, torch.Size([2, 107]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">param_groups</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">lr_find</span><span class="p">(</span><span class="n">suggestions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>SuggestedLRs(lr_min=0.00010000000474974513, lr_steep=7.585775847473997e-07)</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lr_max</span><span class="o">=</span><span class="mf">4e-5</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="n">fit_cbs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>bleu</th>
      <th>meteor</th>
      <th>sacrebleu</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>2.230384</td>
      <td>2.069078</td>
      <td>0.092090</td>
      <td>0.291146</td>
      <td>8.564432</td>
      <td>02:34</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">show_results</span><span class="p">(</span><span class="n">learner</span><span class="o">=</span><span class="n">learn</span><span class="p">,</span> <span class="n">input_trunc_at</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">target_trunc_at</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>target</th>
      <th>prediction</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Angesichts dessen müssen wir in diesem Parlament auf jeden Fall verlangen, daß die gemeinschaftlichen Förderkonzepte für den fraglichen Zeitraum in diesem Parlament vor ihrer Annahme geprüft und erörtert werden, und zwar anhand der Leitlinien, die wir heute vorlegen, denn wir halten sie für ganz besonders geeignet, Arbeitsplätze in den ärmsten oder am wenigsten entwickelten Regionen zu schaffen, und so tragen wir dazu bei, den negativen, zur Ungleichheit führenden Tendenzen in der europäischen</td>
      <td>Bearing this in mind, this House should, in any event, demand that, before the Community support frameworks for the period in question are approved, they be studied and submitted for debate in this Parliament, specifically in light of the guidelines that we have presented today. This is because we think that they are particularly able to create employment in the poorest and least-developed regions and we would thus contribute to reversing the harmful trends towards inequality that exist in Euro</td>
      <td>We therefore have to ensure that, in every case, the European Parliament takes account of the priorities of the European Commission' s own guidelines, and that they are specifically aimed at creating jobs in the most remote regions, and so we have to take account of negative, anti-European trends in the European Union, so that we can achieve a more equal Europe.</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Es kommt eben nicht nur auf die Modernisierung des Gemeinschaftsrechts an, es kommt mehr denn je auf Transparenz der Einzelfallentscheidungen an, auf die Möglichkeit, Entscheidungen auch nachvollziehen zu können, denn die europäische Wettbewerbspolitik wird auf die Akzeptanz der Bevölkerung sowie bei den betroffenen politischen Gremien und bei den betroffenen Unternehmen angewiesen sein.</td>
      <td>Indeed, it is not just about modernisation of Community law, more than anything it is about transparency of decisions taken in individual cases, about the possibility of decisions actually being able to implement decisions, for the European competition policy will be dependent on the population' s acceptance, together with that of the political bodies and enterprises concerned.</td>
      <td>It is not just a matter of modernising the law of competition, but of transparency in the decision-making process and of the right to take action on behalf of the Member States and, more generally, of the private sector. The European competition policy will depend on the social and economic situation of the population and, of course, on the political and economic affairs of the member states and of those affected by it.</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_de</span> <span class="o">=</span> <span class="s2">&quot;Ich trinke gerne Bier&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">outputs</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">blurr_generate</span><span class="p">(</span><span class="n">test_de</span><span class="p">,</span> <span class="n">num_return_sequences</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">outputs</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;=== Prediction </span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1"> ===</span><span class="se">\n</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>=== Prediction 1 ===
 I would like to mention one final beer, a beer called a beer of this kind of beer, and that of course is beer of the beer variety, and not beer of any kind, at all, at least not at present, at present at least in Germany.

=== Prediction 2 ===
 I would like to mention one final beer, a beer called a beer of this kind of beer, and that of course is beer of the beer variety, and not beer of any kind, at all, at least not at present, at present at all.

=== Prediction 3 ===
 I would like to mention one final beer, a beer called a beer of this kind of beer, and that of course is beer of the beer variety, and not beer of any kind, at all, at least not at present, at present at least.

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Inference">Inference<a class="anchor-link" href="#Inference"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">export_fname</span> <span class="o">=</span> <span class="s1">&#39;translation_export&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">learn</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">export_fname</span><span class="si">}</span><span class="s1">.pkl&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inf_learn</span> <span class="o">=</span> <span class="n">load_learner</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">export_fname</span><span class="si">}</span><span class="s1">.pkl&#39;</span><span class="p">)</span>
<span class="n">inf_learn</span><span class="o">.</span><span class="n">blurr_generate</span><span class="p">(</span><span class="n">test_de</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39; I would like to mention one final beer, a beer called a beer of this kind of beer, and that of course is beer of the beer variety, and not beer of any kind, at all, at least not at present, at present at least in Germany.&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Tests">Tests<a class="anchor-link" href="#Tests"> </a></h2><p>The purpose of the following tests is to ensure as much as possible, that the core training code works for the pretrained <strong>summarization models</strong> below.  These tests are excluded from the CI workflow because of how long they would take to run and the amount of data that would be required to download.</p>
<p><strong>Note</strong>: Feel free to modify the code below to test whatever pretrained summarization models you are working with ... and if any of your pretrained summarization models fail, please submit a github issue <em>(or a PR if you'd like to fix it yourself)</em></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span> <span class="k">del</span> <span class="n">learn</span><span class="p">;</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[</span> <span class="n">model_type</span> <span class="k">for</span> <span class="n">model_type</span> <span class="ow">in</span> <span class="n">BLURR_MODEL_HELPER</span><span class="o">.</span><span class="n">get_models</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;ConditionalGeneration&#39;</span><span class="p">)</span> 
 <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">model_type</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;TF&#39;</span><span class="p">))</span> <span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[transformers.models.bart.modeling_bart.BartForConditionalGeneration,
 transformers.models.blenderbot.modeling_blenderbot.BlenderbotForConditionalGeneration,
 transformers.models.blenderbot_small.modeling_blenderbot_small.BlenderbotSmallForConditionalGeneration,
 transformers.models.fsmt.modeling_fsmt.FSMTForConditionalGeneration,
 transformers.models.led.modeling_led.LEDForConditionalGeneration,
 transformers.models.mbart.modeling_mbart.MBartForConditionalGeneration,
 transformers.models.mt5.modeling_mt5.MT5ForConditionalGeneration,
 transformers.models.pegasus.modeling_pegasus.PegasusForConditionalGeneration,
 transformers.models.prophetnet.modeling_prophetnet.ProphetNetForConditionalGeneration,
 transformers.models.t5.modeling_t5.T5ForConditionalGeneration,
 transformers.models.xlm_prophetnet.modeling_xlm_prophetnet.XLMProphetNetForConditionalGeneration]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pretrained_model_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;facebook/bart-base&#39;</span><span class="p">,</span>
    <span class="s1">&#39;facebook/wmt19-de-en&#39;</span><span class="p">,</span>                      <span class="c1"># FSMT</span>
    <span class="s1">&#39;Helsinki-NLP/opus-mt-de-en&#39;</span><span class="p">,</span>                <span class="c1"># MarianMT</span>
    <span class="c1">#&#39;sshleifer/tiny-mbart&#39;,</span>
    <span class="c1">#&#39;google/mt5-small&#39;,</span>
    <span class="s1">&#39;t5-small&#39;</span>
<span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s1">&#39;wmt16&#39;</span><span class="p">,</span> <span class="s1">&#39;de-en&#39;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s1">&#39;train[:1%]&#39;</span><span class="p">)</span>
<span class="n">wmt_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;translation&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;de&#39;</span><span class="p">,</span> <span class="s1">&#39;en&#39;</span><span class="p">]);</span> <span class="nb">len</span><span class="p">(</span><span class="n">wmt_df</span><span class="p">)</span>
<span class="n">wmt_df</span> <span class="o">=</span> <span class="n">wmt_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">1000</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Reusing dataset wmt16 (/home/wgilliam/.cache/huggingface/datasets/wmt16/de-en/1.0.0/7b2c4443a7d34c2e13df267eaa8cab4c62dd82f6b62b0d9ecc2e3a673ce17308)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#hide_output</span>
<span class="n">task</span> <span class="o">=</span> <span class="n">HF_TASKS_AUTO</span><span class="o">.</span><span class="n">Seq2SeqLM</span>
<span class="n">bsz</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">inp_seq_sz</span> <span class="o">=</span> <span class="mi">128</span><span class="p">;</span> <span class="n">trg_seq_sz</span> <span class="o">=</span> <span class="mi">128</span>

<span class="n">test_results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="n">pretrained_model_names</span><span class="p">:</span>
    <span class="n">error</span><span class="o">=</span><span class="kc">None</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;=== </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1"> ===</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="n">hf_arch</span><span class="p">,</span> <span class="n">hf_config</span><span class="p">,</span> <span class="n">hf_tokenizer</span><span class="p">,</span> <span class="n">hf_model</span> <span class="o">=</span> <span class="n">BLURR_MODEL_HELPER</span><span class="o">.</span><span class="n">get_hf_objects</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;architecture:</span><span class="se">\t</span><span class="si">{</span><span class="n">hf_arch</span><span class="si">}</span><span class="se">\n</span><span class="s1">tokenizer:</span><span class="se">\t</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">hf_tokenizer</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="se">\n</span><span class="s1">model:</span><span class="se">\t\t</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="c1"># 1. build your DataBlock</span>
    <span class="n">text_gen_kwargs</span> <span class="o">=</span> <span class="n">default_text_gen_kwargs</span><span class="p">(</span><span class="n">hf_config</span><span class="p">,</span> <span class="n">hf_model</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="s1">&#39;translation&#39;</span><span class="p">)</span>
    
    <span class="n">tok_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">hf_arch</span> <span class="o">==</span> <span class="s1">&#39;mbart&#39;</span><span class="p">):</span>
        <span class="n">tok_kwargs</span><span class="p">[</span><span class="s1">&#39;src_lang&#39;</span><span class="p">],</span> <span class="n">tok_kwargs</span><span class="p">[</span><span class="s1">&#39;tgt_lang&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;de_DE&quot;</span><span class="p">,</span> <span class="s2">&quot;en_XX&quot;</span>
            
    <span class="k">def</span> <span class="nf">add_t5_prefix</span><span class="p">(</span><span class="n">inp</span><span class="p">):</span> <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;translate German to English: </span><span class="si">{</span><span class="n">inp</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="p">(</span><span class="n">hf_arch</span> <span class="o">==</span> <span class="s1">&#39;t5&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">inp</span>
    
    <span class="n">before_batch_tfm</span> <span class="o">=</span> <span class="n">HF_Seq2SeqBeforeBatchTransform</span><span class="p">(</span><span class="n">hf_arch</span><span class="p">,</span> <span class="n">hf_config</span><span class="p">,</span> <span class="n">hf_tokenizer</span><span class="p">,</span> <span class="n">hf_model</span><span class="p">,</span>
                                                      <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;max_length&#39;</span><span class="p">,</span> 
                                                      <span class="n">max_length</span><span class="o">=</span><span class="n">inp_seq_sz</span><span class="p">,</span> 
                                                      <span class="n">max_target_length</span><span class="o">=</span><span class="n">trg_seq_sz</span><span class="p">,</span> 
                                                      <span class="n">tok_kwargs</span><span class="o">=</span><span class="n">tok_kwargs</span><span class="p">,</span> <span class="n">text_gen_kwargs</span><span class="o">=</span><span class="n">text_gen_kwargs</span><span class="p">)</span>
    
    <span class="n">blocks</span> <span class="o">=</span> <span class="p">(</span><span class="n">HF_Seq2SeqBlock</span><span class="p">(</span><span class="n">before_batch_tfm</span><span class="o">=</span><span class="n">before_batch_tfm</span><span class="p">),</span> <span class="n">noop</span><span class="p">)</span>
    <span class="n">dblock</span> <span class="o">=</span> <span class="n">DataBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">,</span> 
                   <span class="n">get_x</span><span class="o">=</span><span class="n">Pipeline</span><span class="p">([</span><span class="n">ColReader</span><span class="p">(</span><span class="s1">&#39;de&#39;</span><span class="p">),</span> <span class="n">add_t5_prefix</span><span class="p">]),</span> 
                   <span class="n">get_y</span><span class="o">=</span><span class="n">ColReader</span><span class="p">(</span><span class="s1">&#39;en&#39;</span><span class="p">),</span> 
                   <span class="n">splitter</span><span class="o">=</span><span class="n">RandomSplitter</span><span class="p">())</span>

    <span class="n">dls</span> <span class="o">=</span> <span class="n">dblock</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">wmt_df</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="n">bsz</span><span class="p">)</span> 
    <span class="n">b</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>

    <span class="c1"># 2. build your Learner</span>
    <span class="n">seq2seq_metrics</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="n">model</span> <span class="o">=</span> <span class="n">HF_BaseModelWrapper</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span>
    <span class="n">fit_cbs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">ShortEpochCallback</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">short_valid</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> 
        <span class="n">HF_Seq2SeqMetricsCallback</span><span class="p">(</span><span class="n">custom_metrics</span><span class="o">=</span><span class="n">seq2seq_metrics</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> 
                    <span class="n">model</span><span class="p">,</span>
                    <span class="n">opt_func</span><span class="o">=</span><span class="n">ranger</span><span class="p">,</span>
                    <span class="n">loss_func</span><span class="o">=</span><span class="n">HF_PreCalculatedLoss</span><span class="p">(),</span>
                    <span class="n">cbs</span><span class="o">=</span><span class="p">[</span><span class="n">HF_BaseModelCallback</span><span class="p">],</span>
                    <span class="n">splitter</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">seq2seq_splitter</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="n">hf_arch</span><span class="p">))</span><span class="o">.</span><span class="n">to_fp16</span><span class="p">()</span>

    <span class="n">learn</span><span class="o">.</span><span class="n">create_opt</span><span class="p">()</span> 
    <span class="n">learn</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span>
    
    <span class="c1"># 3. Run your tests</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*** TESTING DataLoaders ***</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">test_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">test_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;input_ids&#39;</span><span class="p">]),</span> <span class="n">bsz</span><span class="p">)</span>
        <span class="n">test_eq</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;input_ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="n">bsz</span><span class="p">,</span> <span class="n">inp_seq_sz</span><span class="p">]))</span>
        <span class="n">test_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">bsz</span><span class="p">)</span>

<span class="c1">#         print(&#39;*** TESTING One pass through the model ***&#39;)</span>
<span class="c1">#         preds = learn.model(b[0])</span>
<span class="c1">#         test_eq(preds[1].shape[0], bsz)</span>
<span class="c1">#         test_eq(preds[1].shape[2], hf_config.vocab_size)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*** TESTING Training/Results ***&#39;</span><span class="p">)</span>
        <span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lr_max</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="n">fit_cbs</span><span class="p">)</span>

        <span class="n">test_results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hf_arch</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_tokenizer</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;PASSED&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="n">learn</span><span class="o">.</span><span class="n">show_results</span><span class="p">(</span><span class="n">learner</span><span class="o">=</span><span class="n">learn</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">input_trunc_at</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">target_trunc_at</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">test_results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hf_arch</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_tokenizer</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;FAILED&#39;</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># cleanup</span>
        <span class="k">del</span> <span class="n">learn</span><span class="p">;</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>arch</th>
      <th>tokenizer</th>
      <th>model_name</th>
      <th>result</th>
      <th>error</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>bart</td>
      <td>BartTokenizerFast</td>
      <td>BartForConditionalGeneration</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td>fsmt</td>
      <td>FSMTTokenizer</td>
      <td>FSMTForConditionalGeneration</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td>marian</td>
      <td>MarianTokenizer</td>
      <td>MarianMTModel</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>3</th>
      <td>t5</td>
      <td>T5TokenizerFast</td>
      <td>T5ForConditionalGeneration</td>
      <td>PASSED</td>
      <td></td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Cleanup">Cleanup<a class="anchor-link" href="#Cleanup"> </a></h2>
</div>
</div>
</div>
</div>
 

