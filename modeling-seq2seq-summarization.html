---

title: modeling.seq2seq.summarization


keywords: fastai
sidebar: home_sidebar

summary: "This module contains custom models, custom splitters, etc... summarization tasks."
description: "This module contains custom models, custom splitters, etc... summarization tasks."
nb_path: "nbs/11_modeling-seq2seq-summarization.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/11_modeling-seq2seq-summarization.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>What we&#39;re running with at the time this documentation was generated:
torch: 1.10.2+cu102
fastai: 2.5.3
transformers: 4.16.2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">set_device</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using GPU #</span><span class="si">{</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">current_device</span><span class="p">()</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">get_device_name</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Using GPU #1: GeForce GTX 1080 Ti
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Mid-level-API">Mid-level API<a class="anchor-link" href="#Mid-level-API"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Example">Example<a class="anchor-link" href="#Example"> </a></h3><p>The objective of summarization is to generate a concise and accurate representation of a much larger body of text.  For example, we may want to summarize an article in a single sentence.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;cnn_dailymail&quot;</span><span class="p">,</span> <span class="s2">&quot;3.0.0&quot;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train[:1000]&quot;</span><span class="p">)</span>
<span class="n">cnndm_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="n">cnndm_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Reusing dataset cnn_dailymail (/home/wgilliam/.cache/huggingface/datasets/cnn_dailymail/3.0.0/3.0.0/3cb851bf7cf5826e45d49db2863f627cba583cbc32342df7349dfe6c38060234)
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>article</th>
      <th>highlights</th>
      <th>id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>It's official: U.S. President Barack Obama wants lawmakers to weigh in on whether to use military force in Syria. Obama sent a letter to the heads of the House and Senate on Saturday night, hours after announcing that he believes military action against Syrian targets is the right step to take over the alleged use of chemical weapons. The proposed legislation from Obama asks Congress to approve the use of military force "to deter, disrupt, prevent and degrade the potential for future uses of chemical weapons or other weapons of mass destruction." It's a step that is set to turn an internat...</td>
      <td>Syrian official: Obama climbed to the top of the tree, "doesn't know how to get down"\nObama sends a letter to the heads of the House and Senate .\nObama to seek congressional approval on military action against Syria .\nAim is to determine whether CW were used, not by whom, says U.N. spokesman .</td>
      <td>0001d1afc246a7964130f43ae940af6bc6c57f01</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(CNN) -- Usain Bolt rounded off the world championships Sunday by claiming his third gold in Moscow as he anchored Jamaica to victory in the men's 4x100m relay. The fastest man in the world charged clear of United States rival Justin Gatlin as the Jamaican quartet of Nesta Carter, Kemar Bailey-Cole, Nickel Ashmeade and Bolt won in 37.36 seconds. The U.S finished second in 37.56 seconds with Canada taking the bronze after Britain were disqualified for a faulty handover. The 26-year-old Bolt has now collected eight gold medals at world championships, equaling the record held by American trio...</td>
      <td>Usain Bolt wins third gold of world championship .\nAnchors Jamaica to 4x100m relay victory .\nEighth gold at the championships for Bolt .\nJamaica double up in women's 4x100m relay .</td>
      <td>0002095e55fcbd3a2f366d9bf92a95433dc305ef</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pretrained_model_name</span> <span class="o">=</span> <span class="s2">&quot;facebook/bart-large-cnn&quot;</span>
<span class="n">hf_arch</span><span class="p">,</span> <span class="n">hf_config</span><span class="p">,</span> <span class="n">hf_tokenizer</span><span class="p">,</span> <span class="n">hf_model</span> <span class="o">=</span> <span class="n">BLURR</span><span class="o">.</span><span class="n">get_hf_objects</span><span class="p">(</span><span class="n">pretrained_model_name</span><span class="p">,</span> <span class="n">model_cls</span><span class="o">=</span><span class="n">BartForConditionalGeneration</span><span class="p">)</span>

<span class="n">hf_arch</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_config</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_tokenizer</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(&#39;bart&#39;,
 transformers.models.bart.configuration_bart.BartConfig,
 transformers.models.bart.tokenization_bart_fast.BartTokenizerFast,
 transformers.models.bart.modeling_bart.BartForConditionalGeneration)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">text_gen_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">if</span> <span class="n">hf_arch</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;bart&quot;</span><span class="p">,</span> <span class="s2">&quot;t5&quot;</span><span class="p">]:</span>
    <span class="n">text_gen_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">hf_config</span><span class="o">.</span><span class="n">task_specific_params</span><span class="p">[</span><span class="s2">&quot;summarization&quot;</span><span class="p">],</span> <span class="o">**</span><span class="p">{</span><span class="s2">&quot;max_length&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s2">&quot;min_length&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}}</span>

<span class="c1"># not all &quot;summarization&quot; parameters are for the model.generate method ... remove them here</span>
<span class="n">generate_func_args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">hf_model</span><span class="o">.</span><span class="n">generate</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">text_gen_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">generate_func_args</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">text_gen_kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

<span class="k">if</span> <span class="n">hf_arch</span> <span class="o">==</span> <span class="s2">&quot;mbart&quot;</span><span class="p">:</span>
    <span class="n">text_gen_kwargs</span><span class="p">[</span><span class="s2">&quot;decoder_start_token_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hf_tokenizer</span><span class="o">.</span><span class="n">get_vocab</span><span class="p">()[</span><span class="s2">&quot;en_XX&quot;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tok_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">if</span> <span class="n">hf_arch</span> <span class="o">==</span> <span class="s2">&quot;mbart&quot;</span><span class="p">:</span>
    <span class="n">tok_kwargs</span><span class="p">[</span><span class="s2">&quot;src_lang&quot;</span><span class="p">],</span> <span class="n">tok_kwargs</span><span class="p">[</span><span class="s2">&quot;tgt_lang&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;en_XX&quot;</span><span class="p">,</span> <span class="s2">&quot;en_XX&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">batch_tokenize_tfm</span> <span class="o">=</span> <span class="n">Seq2SeqBatchTokenizeTransform</span><span class="p">(</span>
    <span class="n">hf_arch</span><span class="p">,</span>
    <span class="n">hf_config</span><span class="p">,</span>
    <span class="n">hf_tokenizer</span><span class="p">,</span>
    <span class="n">hf_model</span><span class="p">,</span>
    <span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
    <span class="n">max_target_length</span><span class="o">=</span><span class="mi">130</span><span class="p">,</span>
    <span class="n">tok_kwargs</span><span class="o">=</span><span class="n">tok_kwargs</span><span class="p">,</span>
    <span class="n">text_gen_kwargs</span><span class="o">=</span><span class="n">text_gen_kwargs</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">blocks</span> <span class="o">=</span> <span class="p">(</span><span class="n">Seq2SeqTextBlock</span><span class="p">(</span><span class="n">batch_tokenize_tfm</span><span class="o">=</span><span class="n">batch_tokenize_tfm</span><span class="p">),</span> <span class="n">noop</span><span class="p">)</span>

<span class="n">dblock</span> <span class="o">=</span> <span class="n">DataBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">,</span> <span class="n">get_x</span><span class="o">=</span><span class="n">ColReader</span><span class="p">(</span><span class="s2">&quot;article&quot;</span><span class="p">),</span> <span class="n">get_y</span><span class="o">=</span><span class="n">ColReader</span><span class="p">(</span><span class="s2">&quot;highlights&quot;</span><span class="p">),</span> <span class="n">splitter</span><span class="o">=</span><span class="n">RandomSplitter</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span> <span class="o">=</span> <span class="n">dblock</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">cnndm_df</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;input_ids&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(2, torch.Size([2, 256]), torch.Size([2, 70]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span><span class="o">.</span><span class="n">show_batch</span><span class="p">(</span><span class="n">dataloaders</span><span class="o">=</span><span class="n">dls</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>&lt;s&gt; Washington (CNN) -- New details emerged of what the White House knew about the Internal Revenue Service targeting of conservative groups, with spokesman Jay Carney disclosing Chief of Staff Denis McDonough was among the top officials made aware of the matter late last month. In a new timeline provided by Carney to reporters on Monday, General Counsel Kathryn Ruemmler learned on April 24 of a pending Treasury inspector general's report on how IRS staff used criteria targeting conservative groups in assessing eligibility for tax-exempt status. According to Carney, Ruemmler told McDonough as well as other Treasury officials about the pending report. It was the first time the White House acknowledged that McDonough was aware of the report before it became public in early May. IRS: By the numbers. In addition, Carney made clear that the information Ruemmler received on April 24 included details of improper acts by IRS officials. At the same time, Carney emphasized that the information was preliminary and could have changed before the inspector general released his final report on May 14. Carney insisted no one -- including Ruemmler and McDonough -- told President Barack Obama anything about the inspector general's pending report before media reports about it began appearing on May 10. "We knew the subject of the investigation&lt;/s&gt;</td>
      <td>A Senate committee holds a hearing Tuesday on the IRS targeting.\nWhite House discloses new details of what it knew about the IRS targeting report.\nWhite House spokesman says President Obama wasn't told of the pending report.\nNEW: First lawsuit filed over IRS targeting.</td>
    </tr>
    <tr>
      <th>1</th>
      <td>&lt;s&gt; (CNN) -- A spate of deadly shootings during anti-drug operations in Honduras -- including two in which U.S. agents killed suspects -- is linked to an aggressive new strategy to disrupt a preferred corridor for traffickers. Operation Anvil, as the multinational mission is known, differs from past efforts because of its reliance on military outposts close to the front lines to provide quick responses. It is a strategy reminiscent of counterinsurgency tactics used by the U.S. military on battlefields in Iraq and Afghanistan. In a two-month span, six people have been killed in the operation, including possibly four innocent civilians. Despite the controversial shootings, American and Honduran officials say they both are happy with their collaboration and consider Operation Anvil -- launched in April -- a success. As of Wednesday, authorities said, they had interdicted five planes, seized about 2,300 kilos of cocaine, and made seven arrests. Firearms, including military assault rifles, have also been seized. "The amount of drugs seized and the disruption of narcotrafficking routes speak for themselves," said Jorge Ramon Hernandez Alcerro, the Honduran ambassador to the United States. Meanwhile, critics in Honduras and the United States oppose the law enforcement strategy and question why&lt;/s&gt;</td>
      <td>Six people have been killed in three incidents over the past two months in Honduras.\nThe incidents happened during the course of Operation Anvil, a joint Honduran-U.S. effort.\nBoth countries consider it a successful program against traffickers.\nCritics decry what they call the militarization of the drug war.</td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Training">Training<a class="anchor-link" href="#Training"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">seq2seq_metrics</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;rouge&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;compute_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;rouge_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;rouge1&quot;</span><span class="p">,</span> <span class="s2">&quot;rouge2&quot;</span><span class="p">,</span> <span class="s2">&quot;rougeL&quot;</span><span class="p">,</span> <span class="s2">&quot;rougeLsum&quot;</span><span class="p">],</span> <span class="s2">&quot;use_stemmer&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="s2">&quot;returns&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;rouge1&quot;</span><span class="p">,</span> <span class="s2">&quot;rouge2&quot;</span><span class="p">,</span> <span class="s2">&quot;rougeL&quot;</span><span class="p">,</span> <span class="s2">&quot;rougeLsum&quot;</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="s2">&quot;bertscore&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;compute_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lang&quot;</span><span class="p">:</span> <span class="s2">&quot;en&quot;</span><span class="p">},</span> <span class="s2">&quot;returns&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;precision&quot;</span><span class="p">,</span> <span class="s2">&quot;recall&quot;</span><span class="p">,</span> <span class="s2">&quot;f1&quot;</span><span class="p">]},</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">BaseModelWrapper</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span>
<span class="n">learn_cbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">BaseModelCallback</span><span class="p">]</span>
<span class="n">fit_cbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Seq2SeqMetricsCallback</span><span class="p">(</span><span class="n">custom_metrics</span><span class="o">=</span><span class="n">seq2seq_metrics</span><span class="p">)]</span>

<span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span>
    <span class="n">dls</span><span class="p">,</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">opt_func</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">Adam</span><span class="p">),</span>
    <span class="n">loss_func</span><span class="o">=</span><span class="n">CrossEntropyLossFlat</span><span class="p">(),</span>  <span class="c1"># PreCalculatedLoss()</span>
    <span class="n">cbs</span><span class="o">=</span><span class="n">learn_cbs</span><span class="p">,</span>
    <span class="n">splitter</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">blurr_seq2seq_splitter</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="n">hf_arch</span><span class="p">),</span>
<span class="p">)</span> 

<span class="c1"># learn = learn.to_native_fp16() #.to_fp16()</span>
<span class="n">learn</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="nb">len</span><span class="p">(</span><span class="n">preds</span><span class="p">),</span> <span class="n">preds</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">preds</span><span class="p">[</span><span class="s2">&quot;logits&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(4, torch.Size([]), torch.Size([2, 69, 50264]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;input_ids&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(2, 3, torch.Size([2, 256]), 2, torch.Size([2, 69]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">param_groups</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">lr_find</span><span class="p">(</span><span class="n">suggest_funcs</span><span class="o">=</span><span class="p">[</span><span class="n">minimum</span><span class="p">,</span> <span class="n">steep</span><span class="p">,</span> <span class="n">valley</span><span class="p">,</span> <span class="n">slide</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "></div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>SuggestedLRs(minimum=4.786300996784121e-05, steep=1.3182567499825382e-06, valley=4.365158383734524e-05, slide=6.918309736647643e-06)</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lr_max</span><span class="o">=</span><span class="mf">4e-5</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="n">fit_cbs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>rouge1</th>
      <th>rouge2</th>
      <th>rougeL</th>
      <th>rougeLsum</th>
      <th>bertscore_precision</th>
      <th>bertscore_recall</th>
      <th>bertscore_f1</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.766606</td>
      <td>1.762009</td>
      <td>0.303269</td>
      <td>0.134765</td>
      <td>0.236823</td>
      <td>0.281024</td>
      <td>0.890571</td>
      <td>0.864585</td>
      <td>0.877268</td>
      <td>02:00</td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Showing-results">Showing results<a class="anchor-link" href="#Showing-results"> </a></h4><p>And here we create a <code>@typedispatch</code>ed implementation of <code>Learner.show_results</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">show_results</span><span class="p">(</span><span class="n">learner</span><span class="o">=</span><span class="n">learn</span><span class="p">,</span> <span class="n">input_trunc_at</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">target_trunc_at</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "></div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>target</th>
      <th>prediction</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(CNN) -- When Ji Yeqing awakened, she was already in the recovery room. Chinese authorities had dragged her out of her home and down four flights of stairs, she said, restraining and beating her husband as he tried to come to her aid. They whisked her into a clinic, held her down on a bed and forced her to undergo an abortion. Her offense? Becoming pregnant with a second child, in violation of China's one-child policy. "After the abortion, I felt empty, as if something was scooped out of me," J</td>
      <td>China's one-child policy results in forced abortions and sterilizations, activists say.\nWomen tell of emotional and physical consequences from the procedures.\nActivist Chen Guangcheng works to advocate for victims of such practices.</td>
      <td>Ji Yeqing says she was forced to have an abortion after becoming pregnant in violation of China's one-child policy .</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Editor's note: The following story, based on testimony in Phillip Garrido's trial for a 1976 kidnapping, contains some sexually explicit material. Phillip Garrido is show in an early mug shot taken in connection with the 1976 rape and abduction case. (CNN) -- Fifteen years before the girl was held captive in the shed, there was the woman in the warehouse -- and at least one other woman who escaped capture. Phillip Garrido, who with his wife is charged in the 1991 kidnapping of Jaycee Dugard, ha</td>
      <td>Trial transcripts show Phillip Garrido tried to kidnap woman before Katie Hall in 1976.\nGarrido methodically prepared places to bring kidnapped Hall.\nKidnap suspect spoke in trial about his drug-fueled, uncontrollable sexual urges.\n"You are going wi</td>
      <td>Phillip Garrido was convicted in 1976 kidnapping, rape of Katie Callaway Hall .\nCourt records: He told police it was</td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Prediction">Prediction<a class="anchor-link" href="#Prediction"> </a></h4><p>We add here <a href="/blurr/modeling-seq2seq-summarization.html#Learner.blurr_summarize"><code>Learner.blurr_summarize</code></a> method to bring the results inline with the format returned via Hugging Face's pipeline method</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_article</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">About 10 men armed with pistols and small machine guns raided a casino in Switzerland and made off </span>
<span class="s2">into France with several hundred thousand Swiss francs in the early hours of Sunday morning, police said. </span>
<span class="s2">The men, dressed in black clothes and black ski masks, split into two groups during the raid on the Grand Casino </span>
<span class="s2">Basel, Chief Inspector Peter Gill told CNN. One group tried to break into the casino&#39;s vault on the lower level </span>
<span class="s2">but could not get in, but they did rob the cashier of the money that was not secured, he said. The second group </span>
<span class="s2">of armed robbers entered the upper level where the roulette and blackjack tables are located and robbed the </span>
<span class="s2">cashier there, he said. As the thieves were leaving the casino, a woman driving by and unaware of what was </span>
<span class="s2">occurring unknowingly blocked the armed robbers&#39; vehicles. A gunman pulled the woman from her vehicle, beat </span>
<span class="s2">her, and took off for the French border. The other gunmen followed into France, which is only about 100 </span>
<span class="s2">meters (yards) from the casino, Gill said. There were about 600 people in the casino at the time of the robbery. </span>
<span class="s2">There were no serious injuries, although one guest on the Casino floor was kicked in the head by one of the </span>
<span class="s2">robbers when he moved, the police officer said. Swiss authorities are working closely with French authorities, </span>
<span class="s2">Gill said. The robbers spoke French and drove vehicles with French lRicense plates. CNN&#39;s Andreena Narayan </span>
<span class="s2">contributed to this report.</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">outputs</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">blurr_generate</span><span class="p">(</span><span class="n">test_article</span><span class="p">,</span> <span class="n">num_return_sequences</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">outputs</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== Prediction </span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> ===</span><span class="se">\n</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>=== Prediction 1 ===
 Police say about 10 men robbed a casino in Switzerland and made off with several hundred thousand Swiss francs .
The men, dressed in black clothes and black ski masks, split into two groups during the raid on the Grand Casino Basel .
A woman driving by unknowingly blocked the robbers&#39; vehicles, a police officer says .
There were no serious injuries, although one guest was kicked in the head by one of the robbers .
Police say the robbers spoke French and drove vehicles with French lRicense plates .

=== Prediction 2 ===
 Police say about 10 men robbed a casino in Switzerland and made off with several hundred thousand Swiss francs .
The men, dressed in black clothes and black ski masks, split into two groups during the raid on the Grand Casino Basel .
A woman driving by unknowingly blocked the robbers&#39; vehicles and a gunman beat her up .
There were no serious injuries, although one guest was kicked in the head by one of the robbers .

=== Prediction 3 ===
 Police say about 10 men robbed a casino in Switzerland and made off with several hundred thousand Swiss francs .
The men, dressed in black clothes and black ski masks, split into two groups during the raid on the Grand Casino Basel .
A woman driving by unknowingly blocked the robbers&#39; vehicles and a gunman beat her .
There were no serious injuries, although one guest was kicked in the head by one of the robbers .

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Learner.blurr_summarize" class="doc_header"><code>Learner.blurr_summarize</code><a href="https://github.com/ohmeow/blurr/tree/master/blurr/modeling/seq2seq/summarization.py#L28" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Learner.blurr_summarize</code>(<strong><code>inp</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">blurr_summarize</span><span class="p">(</span><span class="n">test_article</span><span class="p">,</span> <span class="n">num_return_sequences</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[{&#39;summary_text&#39;: &#34; Police say about 10 men robbed a casino in Switzerland and made off with several hundred thousand Swiss francs .\nThe men, dressed in black clothes and black ski masks, split into two groups during the raid on the Grand Casino Basel .\nA woman driving by unknowingly blocked the robbers&#39; vehicles, a police officer says .\nThere were no serious injuries, although one guest was kicked in the head by one of the robbers .\nPolice say the robbers spoke French and drove vehicles with French lRicense plates .&#34;},
 {&#39;summary_text&#39;: &#34; Police say about 10 men robbed a casino in Switzerland and made off with several hundred thousand Swiss francs .\nThe men, dressed in black clothes and black ski masks, split into two groups during the raid on the Grand Casino Basel .\nA woman driving by unknowingly blocked the robbers&#39; vehicles and a gunman beat her up .\nThere were no serious injuries, although one guest was kicked in the head by one of the robbers .&#34;},
 {&#39;summary_text&#39;: &#34; Police say about 10 men robbed a casino in Switzerland and made off with several hundred thousand Swiss francs .\nThe men, dressed in black clothes and black ski masks, split into two groups during the raid on the Grand Casino Basel .\nA woman driving by unknowingly blocked the robbers&#39; vehicles and a gunman beat her .\nThere were no serious injuries, although one guest was kicked in the head by one of the robbers .&#34;}]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Inference">Inference<a class="anchor-link" href="#Inference"> </a></h4><p>Using fast.ai <code>Learner.export</code> and <code>load_learner</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">export_fname</span> <span class="o">=</span> <span class="s2">&quot;summarize_export&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">learn</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">export_fname</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inf_learn</span> <span class="o">=</span> <span class="n">load_learner</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">export_fname</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>
<span class="n">inf_learn</span><span class="o">.</span><span class="n">blurr_summarize</span><span class="p">(</span><span class="n">test_article</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[{&#39;summary_text&#39;: &#39; Police say about 10 men robbed a casino in Switzerland and made off with several hundred thousand Swiss francs .\nThe robbers were&#39;}]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="High-level-API">High-level API<a class="anchor-link" href="#High-level-API"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="BlearnerForSummarization"><a href="/blurr/modeling-seq2seq-summarization.html#BlearnerForSummarization"><code>BlearnerForSummarization</code></a><a class="anchor-link" href="#BlearnerForSummarization"> </a></h3><p>We also introduce a task specific <a href="/blurr/modeling-core.html#Blearner"><code>Blearner</code></a> that get you your DataBlock, DataLoaders, and BLearner in one line of code!</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BlearnerForSummarization" class="doc_header"><code>class</code> <code>BlearnerForSummarization</code><a href="https://github.com/ohmeow/blurr/tree/master/blurr/modeling/seq2seq/summarization.py#L35" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BlearnerForSummarization</code>(<strong><code>dls</code></strong>:<code>DataLoaders</code>, <strong><code>hf_model</code></strong>:<code>PreTrainedModel</code>, <strong><code>base_model_cb</code></strong>:<a href="/blurr/modeling-core.html#BaseModelCallback"><code>BaseModelCallback</code></a>=<em><code>BaseModelCallback</code></em>, <strong><code>loss_func</code></strong>=<em><code>None</code></em>, <strong><code>opt_func</code></strong>=<em><code>Adam</code></em>, <strong><code>lr</code></strong>=<em><code>0.001</code></em>, <strong><code>splitter</code></strong>=<em><code>trainable_params</code></em>, <strong><code>cbs</code></strong>=<em><code>None</code></em>, <strong><code>metrics</code></strong>=<em><code>None</code></em>, <strong><code>path</code></strong>=<em><code>None</code></em>, <strong><code>model_dir</code></strong>=<em><code>'models'</code></em>, <strong><code>wd</code></strong>=<em><code>None</code></em>, <strong><code>wd_bn_bias</code></strong>=<em><code>False</code></em>, <strong><code>train_bn</code></strong>=<em><code>True</code></em>, <strong><code>moms</code></strong>=<em><code>(0.95, 0.85, 0.95)</code></em>) :: <a href="/blurr/modeling-core.html#Blearner"><code>Blearner</code></a></p>
</blockquote>
<p>Group together a <code>model</code>, some <code>dls</code> and a <code>loss_func</code> to handle training</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Example">Example<a class="anchor-link" href="#Example"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">BlearnerForSummarization</span><span class="o">.</span><span class="n">from_data</span><span class="p">(</span>
    <span class="n">cnndm_df</span><span class="p">,</span>
    <span class="s2">&quot;facebook/bart-large-cnn&quot;</span><span class="p">,</span>
    <span class="n">text_attr</span><span class="o">=</span><span class="s2">&quot;article&quot;</span><span class="p">,</span>
    <span class="n">summary_attr</span><span class="o">=</span><span class="s2">&quot;highlights&quot;</span><span class="p">,</span>
    <span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
    <span class="n">max_target_length</span><span class="o">=</span><span class="mi">130</span><span class="p">,</span>
    <span class="n">dblock_splitter</span><span class="o">=</span><span class="n">RandomSplitter</span><span class="p">(),</span>
    <span class="n">dl_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bs&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
<span class="p">)</span><span class="o">.</span><span class="n">to_fp16</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lr_max</span><span class="o">=</span><span class="mf">4e-5</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="p">[</span><span class="n">BlearnerForSummarization</span><span class="o">.</span><span class="n">get_metrics_cb</span><span class="p">()])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>rouge1</th>
      <th>rouge2</th>
      <th>rougeL</th>
      <th>rougeLsum</th>
      <th>bertscore_precision</th>
      <th>bertscore_recall</th>
      <th>bertscore_f1</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.762279</td>
      <td>1.782885</td>
      <td>0.392302</td>
      <td>0.177133</td>
      <td>0.269277</td>
      <td>0.366234</td>
      <td>0.877953</td>
      <td>0.893116</td>
      <td>0.885377</td>
      <td>03:19</td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">show_results</span><span class="p">(</span><span class="n">learner</span><span class="o">=</span><span class="n">learn</span><span class="p">,</span> <span class="n">input_trunc_at</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">target_trunc_at</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "></div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>target</th>
      <th>prediction</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(CNN) -- The generation of gays and lesbians that literally created the modern LGBT movement -- from the heroes of the 1969 Stonewall riots to their slightly younger friends -- is at, or nearing, retirement age. That used to mean the beginning of an extremely difficult time in an LGBT person's life. But as gay baby boomers find more acceptance in mainstream society and continue to do what they've always done -- push to make a better world for the LGBT community -- their retirement options are s</td>
      <td>LGBT baby boomers changed the visibility of the gay community.\nAs they approach retirement, they face different obstacles than their straight counterparts.\nWithout marriage equality, same-sex couples may face financial hardships.\nAdvocates say the s</td>
      <td>Bob Witeck, 61, runs a public relations and marketing company .\nHe says he plans to keep working as he gets older .\nWiteck: "The notion of retirement has never been a part of my vocabulary"\nHe and other gay baby boomers are working hard to make a be</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Hong Kong (CNN) -- When American pop artist Andy Warhol visited Beijing in 1982 and was told there wasn't a McDonald's, he replied: "Oh, but they will." Twenty-six years after his death, Warhol, whose much-lauded prescience extended across visual and consumer culture, has popped up in China once again -- and he was right about the fast-food chain. "Andy Warhol: 15 Minutes Eternal," the first major retrospective of his work in China, recently arrived in Shanghai with the aim of acquainting the C</td>
      <td>First major retrospective of pop artist Andy Warhol's work exhibiting in China.\nWarhol made first and only trip to China in 1982, which provided artistic inspiration.\nWhile iconic works are well-recognized in China, few people connect them with Warh</td>
      <td>Andy Warhol visited China in 1982, his first and only visit to mainland China .\nHis engagement with the country started a decade earlier, inspired by former U.S. president Richard Nixon's rapprochement with the communist power in 1972 .\nWarhol adopt</td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_article</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">About 10 men armed with pistols and small machine guns raided a casino in Switzerland and made off </span>
<span class="s2">into France with several hundred thousand Swiss francs in the early hours of Sunday morning, police said. </span>
<span class="s2">The men, dressed in black clothes and black ski masks, split into two groups during the raid on the Grand Casino </span>
<span class="s2">Basel, Chief Inspector Peter Gill told CNN. One group tried to break into the casino&#39;s vault on the lower level </span>
<span class="s2">but could not get in, but they did rob the cashier of the money that was not secured, he said. The second group </span>
<span class="s2">of armed robbers entered the upper level where the roulette and blackjack tables are located and robbed the </span>
<span class="s2">cashier there, he said. As the thieves were leaving the casino, a woman driving by and unaware of what was </span>
<span class="s2">occurring unknowingly blocked the armed robbers&#39; vehicles. A gunman pulled the woman from her vehicle, beat </span>
<span class="s2">her, and took off for the French border. The other gunmen followed into France, which is only about 100 </span>
<span class="s2">meters (yards) from the casino, Gill said. There were about 600 people in the casino at the time of the robbery. </span>
<span class="s2">There were no serious injuries, although one guest on the Casino floor was kicked in the head by one of the </span>
<span class="s2">robbers when he moved, the police officer said. Swiss authorities are working closely with French authorities, </span>
<span class="s2">Gill said. The robbers spoke French and drove vehicles with French lRicense plates. CNN&#39;s Andreena Narayan </span>
<span class="s2">contributed to this report.</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_article</span><span class="p">,</span> <span class="n">num_return_sequences</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[{&#39;summary_text&#39;: &#34; 10 men rob Swiss casino with pistols, machine guns, police say .\nThey make off with several hundred thousand Swiss francs in the early hours of Sunday morning .\nRobbers spoke French and drove vehicles with French lRicense plates, police said .\nA woman driving by unknowingly blocked the robbers&#39; vehicles as they were leaving the casino .\nThe robbers beat her to death and took off for the French border .&#34;},
 {&#39;summary_text&#39;: &#34; 10 men rob Swiss casino with pistols, machine guns, police say .\nThey make off with several hundred thousand Swiss francs in the early hours of Sunday morning .\nRobbers spoke French and drove vehicles with French lRicense plates, police said .\nA woman driving by unknowingly blocked the robbers&#39; vehicles as they were leaving the casino .\nThe robbers beat her and took off for the French border .&#34;},
 {&#39;summary_text&#39;: &#34; 10 men rob Swiss casino with pistols, machine guns, police say .\nThey make off with several hundred thousand Swiss francs in the early hours of Sunday morning .\nRobbers spoke French and drove vehicles with French lRicense plates, police said .\nA woman driving by unknowingly blocked the robbers&#39; vehicles and a gunman beat her to death .&#34;}]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">export_fname</span> <span class="o">=</span> <span class="s2">&quot;summarize_export&quot;</span>

<span class="n">learn</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">to_fp32</span><span class="p">()</span>
<span class="n">learn</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">export_fname</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>

<span class="n">inf_learn</span> <span class="o">=</span> <span class="n">load_learner</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">export_fname</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>
<span class="n">inf_learn</span><span class="o">.</span><span class="n">blurr_summarize</span><span class="p">(</span><span class="n">test_article</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[{&#39;summary_text&#39;: &#34; Robbers made off with several hundred thousand Swiss francs in the early hours of Sunday morning, police say .\nThe men, dressed in black clothes and black ski masks, split into two groups during the raid on the Grand Casino .\nA woman driving by and unaware of what was happening unknowingly blocked the robbers&#39; vehicles .\nShe was beaten and robbed by a gunman, who then took off for the French border .\nThere were about 600 people in the casino at the time of the robbery .&#34;}]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Tests">Tests<a class="anchor-link" href="#Tests"> </a></h2><p>The purpose of the following tests is to ensure as much as possible, that the core training code works for the pretrained <strong>summarization models</strong> below.  These tests are excluded from the CI workflow because of how long they would take to run and the amount of data that would be required to download.</p>
<p><strong>Note</strong>: Feel free to modify the code below to test whatever pretrained summarization models you are working with ... and if any of your pretrained summarization models fail, please submit a github issue <em>(or a PR if you'd like to fix it yourself)</em></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>arch</th>
      <th>tokenizer</th>
      <th>model_name</th>
      <th>result</th>
      <th>error</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>bart</td>
      <td>BartTokenizerFast</td>
      <td>BartForConditionalGeneration</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td>led</td>
      <td>LEDTokenizerFast</td>
      <td>LEDForConditionalGeneration</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td>mbart</td>
      <td>MBartTokenizerFast</td>
      <td>MBartForConditionalGeneration</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>3</th>
      <td>mt5</td>
      <td>T5TokenizerFast</td>
      <td>MT5ForConditionalGeneration</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>4</th>
      <td>pegasus</td>
      <td>PegasusTokenizerFast</td>
      <td>PegasusForConditionalGeneration</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>5</th>
      <td>t5</td>
      <td>T5TokenizerFast</td>
      <td>T5ForConditionalGeneration</td>
      <td>PASSED</td>
      <td></td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Summary">Summary<a class="anchor-link" href="#Summary"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This module includes the fundamental bits to use Blurr for summarization tasks training and inference.</p>

</div>
</div>
</div>
</div>
 

