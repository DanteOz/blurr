---

title: modeling.seq2seq.translation


keywords: fastai
sidebar: home_sidebar

summary: "This module contains custom models, custom splitters, etc... translation tasks."
description: "This module contains custom models, custom splitters, etc... translation tasks."
nb_path: "nbs/12_modeling-seq2seq-translation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/12_modeling-seq2seq-translation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>What we&#39;re running with at the time this documentation was generated:
torch: 1.10.2+cu102
fastai: 2.5.3
transformers: 4.17.0
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">set_device</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using GPU #</span><span class="si">{</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">current_device</span><span class="p">()</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">get_device_name</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Using GPU #1: GeForce GTX 1080 Ti
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Mid-level-API">Mid-level API<a class="anchor-link" href="#Mid-level-API"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Prepare-the-data">Prepare the data<a class="anchor-link" href="#Prepare-the-data"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Example">Example<a class="anchor-link" href="#Example"> </a></h3><p>The objective in translation is to generate a representation of a given text in another style. For example, we may want to translate German into English or modern English into old English.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;wmt16&quot;</span><span class="p">,</span> <span class="s2">&quot;de-en&quot;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1200</span><span class="p">))</span>
<span class="n">wmt_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;translation&quot;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;de&quot;</span><span class="p">,</span> <span class="s2">&quot;en&quot;</span><span class="p">])</span>
<span class="nb">len</span><span class="p">(</span><span class="n">wmt_df</span><span class="p">)</span>
<span class="n">wmt_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Reusing dataset wmt16 (/home/wgilliam/.cache/huggingface/datasets/wmt16/de-en/1.0.0/af3c5d746b307726d0de73ebe7f10545361b9cb6f75c83a1734c000e48b6264f)
Loading cached shuffled indices for dataset at /home/wgilliam/.cache/huggingface/datasets/wmt16/de-en/1.0.0/af3c5d746b307726d0de73ebe7f10545361b9cb6f75c83a1734c000e48b6264f/cache-8fc54b133c8c43b7.arrow
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>de</th>
      <th>en</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Tada se dio stanovništva preselio uz samu obalu - Pristan, gdje je i nastao Novi grad početkom XX vijeka.</td>
      <td>In that period the majority of the population moved close to the seaside, where the first sea port was founded at the beginning of the 20th century, and later a new city was built.</td>
    </tr>
    <tr>
      <th>1</th>
      <td>"Dieses Video ist nicht verfügbar loger" bitch, daß das Böse, der sein Video auf YouTube hochgeladen hatte nearsyx?</td>
      <td>"This video is no loger available" that evil bitch, who had uploaded his video on youtube nearsyx?</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pretrained_model_name</span> <span class="o">=</span> <span class="s2">&quot;Helsinki-NLP/opus-mt-de-en&quot;</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="n">AutoModelForSeq2SeqLM</span>

<span class="n">hf_arch</span><span class="p">,</span> <span class="n">hf_config</span><span class="p">,</span> <span class="n">hf_tokenizer</span><span class="p">,</span> <span class="n">hf_model</span> <span class="o">=</span> <span class="n">BLURR</span><span class="o">.</span><span class="n">get_hf_objects</span><span class="p">(</span><span class="n">pretrained_model_name</span><span class="p">,</span> <span class="n">model_cls</span><span class="o">=</span><span class="n">model_cls</span><span class="p">)</span>
<span class="n">hf_arch</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_tokenizer</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_config</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(&#39;marian&#39;,
 transformers.models.marian.tokenization_marian.MarianTokenizer,
 transformers.models.marian.configuration_marian.MarianConfig,
 transformers.models.marian.modeling_marian.MarianMTModel)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">blocks</span> <span class="o">=</span> <span class="p">(</span><span class="n">Seq2SeqTextBlock</span><span class="p">(</span><span class="n">hf_arch</span><span class="p">,</span> <span class="n">hf_config</span><span class="p">,</span> <span class="n">hf_tokenizer</span><span class="p">,</span> <span class="n">hf_model</span><span class="p">),</span> <span class="n">noop</span><span class="p">)</span>
<span class="n">dblock</span> <span class="o">=</span> <span class="n">DataBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">,</span> <span class="n">get_x</span><span class="o">=</span><span class="n">ColReader</span><span class="p">(</span><span class="s2">&quot;de&quot;</span><span class="p">),</span> <span class="n">get_y</span><span class="o">=</span><span class="n">ColReader</span><span class="p">(</span><span class="s2">&quot;en&quot;</span><span class="p">),</span> <span class="n">splitter</span><span class="o">=</span><span class="n">RandomSplitter</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span> <span class="o">=</span> <span class="n">dblock</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">wmt_df</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;input_ids&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(2, torch.Size([2, 168]), torch.Size([2, 140]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span><span class="o">.</span><span class="n">show_batch</span><span class="p">(</span><span class="n">dataloaders</span><span class="o">=</span><span class="n">dls</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">input_trunc_at</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">target_trunc_at</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>"In▁Erwägung▁nachstehender▁Gründe▁sollte das▁Europäische▁Parlament▁keinerlei▁Doppelmoral tolerieren. Indessen und um▁politischen Druck auf▁Journalisten▁auszuüben, die▁Korruptionsfälle aufdecken, die in▁Verbindung mit▁hochrangigen▁Beamten und▁regieren</td>
      <td>'whereas the European Parliament shall not accept double standards; whereas, in order to put political pressure on journalists disclosing corruption cases linked to high-ranking officials and ruling party politicians, the Government administration in</td>
    </tr>
    <tr>
      <th>1</th>
      <td>▁Abschließend▁muss▁darauf▁hingewiesen▁werden,▁dass die▁frühere▁Verordnung des Rates Nr. 2371/2002 (EG), auf die in▁diesem▁Dokument▁Bezug▁genommen▁wird,▁darauf▁abzielte,▁bei der▁Umsetzung▁grundlegender▁Reformen in der Fischereipolitik▁Vorsicht walten</td>
      <td>In conclusion, it should be pointed out that the intention of the earlier Council Regulation 2371/2002 mentioned in the document dealt with in the opinion was to retain the precautionary principle in connection with the introduction of fundamental ch</td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Training">Training<a class="anchor-link" href="#Training"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">seq2seq_metrics</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;bleu&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;returns&quot;</span><span class="p">:</span> <span class="s2">&quot;bleu&quot;</span><span class="p">},</span> <span class="s2">&quot;meteor&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;returns&quot;</span><span class="p">:</span> <span class="s2">&quot;meteor&quot;</span><span class="p">},</span> <span class="s2">&quot;sacrebleu&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;returns&quot;</span><span class="p">:</span> <span class="s2">&quot;score&quot;</span><span class="p">}}</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">BaseModelWrapper</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span>
<span class="n">learn_cbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">BaseModelCallback</span><span class="p">]</span>
<span class="n">fit_cbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Seq2SeqMetricsCallback</span><span class="p">(</span><span class="n">custom_metrics</span><span class="o">=</span><span class="n">seq2seq_metrics</span><span class="p">)]</span>

<span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span>
    <span class="n">dls</span><span class="p">,</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">opt_func</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">Adam</span><span class="p">),</span>
    <span class="n">loss_func</span><span class="o">=</span><span class="n">PreCalculatedCrossEntropyLoss</span><span class="p">(),</span>  <span class="c1"># CrossEntropyLossFlat()</span>
    <span class="n">cbs</span><span class="o">=</span><span class="n">learn_cbs</span><span class="p">,</span>
    <span class="n">splitter</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">blurr_seq2seq_splitter</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="n">hf_arch</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># learn = learn.to_native_fp16() #.to_fp16()</span>
<span class="n">learn</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[nltk_data] Downloading package wordnet to /home/wgilliam/nltk_data...
[nltk_data]   Package wordnet is already up-to-date!
[nltk_data] Downloading package punkt to /home/wgilliam/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package omw-1.4 to /home/wgilliam/nltk_data...
[nltk_data]   Package omw-1.4 is already up-to-date!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># learn.summary()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="nb">len</span><span class="p">(</span><span class="n">preds</span><span class="p">),</span> <span class="n">preds</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">preds</span><span class="p">[</span><span class="s2">&quot;logits&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(4, torch.Size([]), torch.Size([2, 140, 58101]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;input_ids&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(2, 3, torch.Size([2, 168]), 2, torch.Size([2, 140]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">param_groups</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">lr_find</span><span class="p">(</span><span class="n">suggest_funcs</span><span class="o">=</span><span class="p">[</span><span class="n">minimum</span><span class="p">,</span> <span class="n">steep</span><span class="p">,</span> <span class="n">valley</span><span class="p">,</span> <span class="n">slide</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "></div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>SuggestedLRs(minimum=2.7542287170945203e-07, steep=1.5848931980144698e-06, valley=0.0003981071640737355, slide=0.00015848931798245758)</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lr_max</span><span class="o">=</span><span class="mf">4e-5</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="n">fit_cbs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>bleu</th>
      <th>meteor</th>
      <th>sacrebleu</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>2.192671</td>
      <td>2.027766</td>
      <td>0.307353</td>
      <td>0.540451</td>
      <td>29.957392</td>
      <td>00:54</td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Showing-results">Showing results<a class="anchor-link" href="#Showing-results"> </a></h4><p>And here we create a <code>@typedispatch</code>ed implementation of <code>Learner.show_results</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">show_results</span><span class="p">(</span><span class="n">learner</span><span class="o">=</span><span class="n">learn</span><span class="p">,</span> <span class="n">input_trunc_at</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">target_trunc_at</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "></div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>target</th>
      <th>prediction</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Reyes Ruiz▁ist ein▁dummer Neuling, hat▁nur ein▁Narr in den▁Kopf,▁dass in▁einer "rote" Zone der▁Toleranz in▁diesen Momenten zu▁investieren,▁wenn Sie eine▁andere Art von▁Freizeiteinrichtungen für▁Jugendliche der Stadt,▁dass das▁Fehlen von▁Freizeit-Räume▁beginnen in▁Alkohol von▁einem▁frühen Alter,▁müssen wir▁Kinos,▁Einkaufszentren, etc,▁etwas▁gerichtet, um▁keinen▁Anreiz jovens▁Bereiche in▁denen die Prostitution yl▁Konsum▁alkoholischer▁Getränke, das▁ist▁mein▁Kommentar▁heute..</td>
      <td>Reyes Ruiz is a stupid neophyte, only a fool has in his head that invest in a "Red" zone of tolerance in these moments when you need another type of recreational facilities for young people of the city that the lack of recreational spaces begin in alcohol from an early age, we need movie theaters, shopping malls, etc, something directed to jovens no incentive areas where prostitution yl consumption of alcoholic beverages, this is my comment today..</td>
      <td>[Reyes Ruiz is a stupid novice who has just a fool in his head that in a "red" zone of tolerance to invest in these moments, if you have another type of leisure facilities for teens of the city that the lack of leisure spaces start in alcohol from an early age, we need cinemas, shopping malls, etc, something aimed at not encouraging jovens areas in which prostitution yl consumption of alcoholic beverages, that is my comment today .., (12) If, within the time limit laid down in paragraph 9, one or more competent national authority(s) cannot agree to the mutual recognition of the draft decision by the competent authority of the reference Member State, the procedure laid down in Article 35(2) of Directive 2001/83/EC or Article 39(2) of Directive 2001/82/EC shall apply.]</td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Prediction">Prediction<a class="anchor-link" href="#Prediction"> </a></h4><p>We add here <a href="/blurr/modeling-seq2seq-translation.html#Learner.blurr_translate"><code>Learner.blurr_translate</code></a> method to bring the results inline with the format returned via Hugging Face's pipeline method</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_de</span> <span class="o">=</span> <span class="s2">&quot;Ich trinke gerne Bier&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">outputs</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">blurr_generate</span><span class="p">(</span><span class="n">test_de</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;translation_texts&quot;</span><span class="p">,</span> <span class="n">num_return_sequences</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">outputs</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[{&#39;translation_texts&#39;: [&#39;I like to drink beer&#39;,
   &#39;I like to drink beer.&#39;,
   &#39;I like to drink&#39;]}]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Learner.blurr_translate" class="doc_header"><code>Learner.blurr_translate</code><a href="https://github.com/ohmeow/blurr/tree/master/blurr/modeling/seq2seq/translation.py#L28" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Learner.blurr_translate</code>(<strong><code>inp</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">blurr_translate</span><span class="p">(</span><span class="n">test_de</span><span class="p">,</span> <span class="n">num_return_sequences</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[{&#39;translation_texts&#39;: [&#39;I like to drink beer&#39;,
   &#39;I like to drink beer.&#39;,
   &#39;I like to drink&#39;]}]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Inference">Inference<a class="anchor-link" href="#Inference"> </a></h4><p>Using fast.ai <code>Learner.export</code> and <code>load_learner</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">export_fname</span> <span class="o">=</span> <span class="s2">&quot;translation_export&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">learn</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">export_fname</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inf_learn</span> <span class="o">=</span> <span class="n">load_learner</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">export_fname</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>
<span class="n">inf_learn</span><span class="o">.</span><span class="n">blurr_translate</span><span class="p">(</span><span class="n">test_de</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[{&#39;translation_texts&#39;: &#39;I like to drink beer&#39;}]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="High-level-API">High-level API<a class="anchor-link" href="#High-level-API"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="BlearnerForTranslation"><a href="/blurr/modeling-seq2seq-translation.html#BlearnerForTranslation"><code>BlearnerForTranslation</code></a><a class="anchor-link" href="#BlearnerForTranslation"> </a></h3><p>We also introduce a task specific <a href="/blurr/modeling-core.html#Blearner"><code>Blearner</code></a> that get you your DataBlock, DataLoaders, and BLearner in one line of code!</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BlearnerForTranslation" class="doc_header"><code>class</code> <code>BlearnerForTranslation</code><a href="https://github.com/ohmeow/blurr/tree/master/blurr/modeling/seq2seq/translation.py#L36" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BlearnerForTranslation</code>(<strong><code>dls</code></strong>:<code>DataLoaders</code>, <strong><code>hf_model</code></strong>:<code>PreTrainedModel</code>, <strong><code>base_model_cb</code></strong>:<a href="/blurr/modeling-core.html#BaseModelCallback"><code>BaseModelCallback</code></a>=<em><code>BaseModelCallback</code></em>, <strong><code>loss_func</code></strong>=<em><code>None</code></em>, <strong><code>opt_func</code></strong>=<em><code>Adam</code></em>, <strong><code>lr</code></strong>=<em><code>0.001</code></em>, <strong><code>splitter</code></strong>=<em><code>trainable_params</code></em>, <strong><code>cbs</code></strong>=<em><code>None</code></em>, <strong><code>metrics</code></strong>=<em><code>None</code></em>, <strong><code>path</code></strong>=<em><code>None</code></em>, <strong><code>model_dir</code></strong>=<em><code>'models'</code></em>, <strong><code>wd</code></strong>=<em><code>None</code></em>, <strong><code>wd_bn_bias</code></strong>=<em><code>False</code></em>, <strong><code>train_bn</code></strong>=<em><code>True</code></em>, <strong><code>moms</code></strong>=<em><code>(0.95, 0.85, 0.95)</code></em>) :: <a href="/blurr/modeling-core.html#Blearner"><code>Blearner</code></a></p>
</blockquote>
<p>Group together a <code>model</code>, some <code>dls</code> and a <code>loss_func</code> to handle training</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">BlearnerForTranslation</span><span class="o">.</span><span class="n">from_data</span><span class="p">(</span>
    <span class="n">wmt_df</span><span class="p">,</span>
    <span class="s2">&quot;Helsinki-NLP/opus-mt-de-en&quot;</span><span class="p">,</span>
    <span class="n">src_lang_name</span><span class="o">=</span><span class="s2">&quot;German&quot;</span><span class="p">,</span>
    <span class="n">src_lang_attr</span><span class="o">=</span><span class="s2">&quot;de&quot;</span><span class="p">,</span>
    <span class="n">trg_lang_name</span><span class="o">=</span><span class="s2">&quot;English&quot;</span><span class="p">,</span>
    <span class="n">trg_lang_attr</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">,</span>
    <span class="n">dl_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bs&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">metrics_cb</span> <span class="o">=</span> <span class="n">BlearnerForTranslation</span><span class="o">.</span><span class="n">get_metrics_cb</span><span class="p">()</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lr_max</span><span class="o">=</span><span class="mf">4e-5</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="p">[</span><span class="n">metrics_cb</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[nltk_data] Downloading package wordnet to /home/wgilliam/nltk_data...
[nltk_data]   Package wordnet is already up-to-date!
[nltk_data] Downloading package punkt to /home/wgilliam/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package omw-1.4 to /home/wgilliam/nltk_data...
[nltk_data]   Package omw-1.4 is already up-to-date!
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>bleu</th>
      <th>meteor</th>
      <th>sacrebleu</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>2.135929</td>
      <td>2.162880</td>
      <td>0.294676</td>
      <td>0.534788</td>
      <td>28.069091</td>
      <td>00:57</td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">show_results</span><span class="p">(</span><span class="n">learner</span><span class="o">=</span><span class="n">learn</span><span class="p">,</span> <span class="n">input_trunc_at</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">target_trunc_at</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "></div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>target</th>
      <th>prediction</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>"In▁Erwägung▁nachstehender▁Gründe▁sollte das▁Europäische▁Parlament▁keinerlei▁Doppelmoral tolerieren. Indessen und um▁politischen Druck auf▁Journalisten▁auszuüben, die▁Korruptionsfälle aufdecken, die in▁Verbindung mit▁hochrangigen▁Beamten und▁regierenden▁Politikern der▁Partei▁stehen, hat die▁ungarische Staatsverwaltung vor Kurzem▁Schritte▁eingeleitet, um▁Strafverfahren▁gegen▁derartige▁Vertreter der Medien▁anzustrengen -▁nämlich▁gegen▁Herrn Tamás Pindroch, den▁Journalisten von Magyar Hírlap -,▁wob</td>
      <td>'whereas the European Parliament shall not accept double standards; whereas, in order to put political pressure on journalists disclosing corruption cases linked to high-ranking officials and ruling party politicians, the Government administration in</td>
      <td>["The European Parliament should not tolerate any double standards, however, and in order to exert political pressure on journalists to expose corruption cases related to high-ranking officials and political leaders of the Party, the Hungarian State Administration has recently taken steps to bring criminal proceedings against such media representatives, namely Mr Tamás Pindroch, the journalist of Magyar Hírlap, taking particular account of the fact that criminal proceedings have been launched against the journalist who has been investigating scandals related to senior former members of the government and one of the candidates for the office of European Commissioner., To this end, it is important to revolutionise the methods in order to achieve a significantly higher reach and effectiveness than the policies of the past. The Member States of the European Union, but also the candidate countries, in cooperation with the European Commission, must take all appropriate measures to disseminate the best practice and adopt those new models which are the success of the leading states.]</td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_de</span> <span class="o">=</span> <span class="s2">&quot;Ich trinke gerne Bier&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">blurr_translate</span><span class="p">(</span><span class="n">test_de</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[{&#39;translation_texts&#39;: &#39;I like to drink beer&#39;}]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">export_fname</span> <span class="o">=</span> <span class="s2">&quot;translation_export&quot;</span>

<span class="n">learn</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">to_fp32</span><span class="p">()</span>
<span class="n">learn</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">export_fname</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>

<span class="n">inf_learn</span> <span class="o">=</span> <span class="n">load_learner</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">export_fname</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>
<span class="n">inf_learn</span><span class="o">.</span><span class="n">blurr_generate</span><span class="p">(</span><span class="n">test_de</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[{&#39;generated_texts&#39;: &#39;I like to drink beer&#39;}]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Tests">Tests<a class="anchor-link" href="#Tests"> </a></h2><p>The purpose of the following tests is to ensure as much as possible, that the core training code works for the pretrained <strong>translation models</strong> below.  These tests are excluded from the CI workflow because of how long they would take to run and the amount of data that would be required to download.</p>
<p><strong>Note</strong>: Feel free to modify the code below to test whatever pretrained summarization models you are working with ... and if any of your pretrained translation models fail, please submit a github issue <em>(or a PR if you'd like to fix it yourself)</em></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="k">del</span> <span class="n">learn</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[</span><span class="n">model_type</span> <span class="k">for</span> <span class="n">model_type</span> <span class="ow">in</span> <span class="n">BLURR</span><span class="o">.</span><span class="n">get_models</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s2">&quot;ConditionalGeneration&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">model_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;TF&quot;</span><span class="p">))]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;BartForConditionalGeneration&#39;,
 &#39;BigBirdPegasusForConditionalGeneration&#39;,
 &#39;BlenderbotForConditionalGeneration&#39;,
 &#39;BlenderbotSmallForConditionalGeneration&#39;,
 &#39;FSMTForConditionalGeneration&#39;,
 &#39;LEDForConditionalGeneration&#39;,
 &#39;M2M100ForConditionalGeneration&#39;,
 &#39;MBartForConditionalGeneration&#39;,
 &#39;MT5ForConditionalGeneration&#39;,
 &#39;PegasusForConditionalGeneration&#39;,
 &#39;ProphetNetForConditionalGeneration&#39;,
 &#39;Speech2TextForConditionalGeneration&#39;,
 &#39;T5ForConditionalGeneration&#39;,
 &#39;XLMProphetNetForConditionalGeneration&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pretrained_model_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;facebook/bart-base&quot;</span><span class="p">,</span>
    <span class="s2">&quot;facebook/wmt19-de-en&quot;</span><span class="p">,</span>  <span class="c1"># FSMT</span>
    <span class="s2">&quot;Helsinki-NLP/opus-mt-de-en&quot;</span><span class="p">,</span>  <span class="c1"># MarianMT</span>
    <span class="c1">#&#39;sshleifer/tiny-mbart&#39;,</span>
    <span class="c1">#&#39;google/mt5-small&#39;,</span>
    <span class="s2">&quot;t5-small&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;wmt16&quot;</span><span class="p">,</span> <span class="s2">&quot;de-en&quot;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1200</span><span class="p">))</span>
<span class="n">wmt_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;translation&quot;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;de&quot;</span><span class="p">,</span> <span class="s2">&quot;en&quot;</span><span class="p">])</span>
<span class="nb">len</span><span class="p">(</span><span class="n">wmt_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Reusing dataset wmt16 (/home/wgilliam/.cache/huggingface/datasets/wmt16/de-en/1.0.0/af3c5d746b307726d0de73ebe7f10545361b9cb6f75c83a1734c000e48b6264f)
Loading cached shuffled indices for dataset at /home/wgilliam/.cache/huggingface/datasets/wmt16/de-en/1.0.0/af3c5d746b307726d0de73ebe7f10545361b9cb6f75c83a1734c000e48b6264f/cache-8fc54b133c8c43b7.arrow
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>1200</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># hide_output</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="n">AutoModelForSeq2SeqLM</span>
<span class="n">bsz</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">inp_seq_sz</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">trg_seq_sz</span> <span class="o">=</span> <span class="mi">128</span>

<span class="n">test_results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="n">pretrained_model_names</span><span class="p">:</span>
    <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">hf_tok_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s2">&quot;sshleifer/tiny-mbart&quot;</span><span class="p">:</span>
        <span class="n">hf_tok_kwargs</span><span class="p">[</span><span class="s2">&quot;src_lang&quot;</span><span class="p">],</span> <span class="n">hf_tok_kwargs</span><span class="p">[</span><span class="s2">&quot;tgt_lang&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;de_DE&quot;</span><span class="p">,</span> <span class="s2">&quot;en_XX&quot;</span>

    <span class="n">hf_arch</span><span class="p">,</span> <span class="n">hf_config</span><span class="p">,</span> <span class="n">hf_tokenizer</span><span class="p">,</span> <span class="n">hf_model</span> <span class="o">=</span> <span class="n">BLURR</span><span class="o">.</span><span class="n">get_hf_objects</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">model_cls</span><span class="o">=</span><span class="n">model_cls</span><span class="p">,</span> <span class="n">tokenizer_kwargs</span><span class="o">=</span><span class="n">hf_tok_kwargs</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;architecture:</span><span class="se">\t</span><span class="si">{</span><span class="n">hf_arch</span><span class="si">}</span><span class="se">\n</span><span class="s2">tokenizer:</span><span class="se">\t</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">hf_tokenizer</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="se">\n</span><span class="s2">model:</span><span class="se">\t\t</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 1. build your DataBlock</span>
    <span class="n">text_gen_kwargs</span> <span class="o">=</span> <span class="n">default_text_gen_kwargs</span><span class="p">(</span><span class="n">hf_config</span><span class="p">,</span> <span class="n">hf_model</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="s2">&quot;translation&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_t5_prefix</span><span class="p">(</span><span class="n">inp</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;translate German to English: </span><span class="si">{</span><span class="n">inp</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">hf_arch</span> <span class="o">==</span> <span class="s2">&quot;t5&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">inp</span>

    <span class="n">batch_tokenize_tfm</span> <span class="o">=</span> <span class="n">Seq2SeqBatchTokenizeTransform</span><span class="p">(</span>
        <span class="n">hf_arch</span><span class="p">,</span>
        <span class="n">hf_config</span><span class="p">,</span>
        <span class="n">hf_tokenizer</span><span class="p">,</span>
        <span class="n">hf_model</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;max_length&quot;</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="n">inp_seq_sz</span><span class="p">,</span>
        <span class="n">max_target_length</span><span class="o">=</span><span class="n">trg_seq_sz</span><span class="p">,</span>
        <span class="n">text_gen_kwargs</span><span class="o">=</span><span class="n">text_gen_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">blocks</span> <span class="o">=</span> <span class="p">(</span><span class="n">Seq2SeqTextBlock</span><span class="p">(</span><span class="n">batch_tokenize_tfm</span><span class="o">=</span><span class="n">batch_tokenize_tfm</span><span class="p">),</span> <span class="n">noop</span><span class="p">)</span>
    <span class="n">dblock</span> <span class="o">=</span> <span class="n">DataBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">,</span> <span class="n">get_x</span><span class="o">=</span><span class="n">Pipeline</span><span class="p">([</span><span class="n">ColReader</span><span class="p">(</span><span class="s2">&quot;de&quot;</span><span class="p">),</span> <span class="n">add_t5_prefix</span><span class="p">]),</span> <span class="n">get_y</span><span class="o">=</span><span class="n">ColReader</span><span class="p">(</span><span class="s2">&quot;en&quot;</span><span class="p">),</span> <span class="n">splitter</span><span class="o">=</span><span class="n">RandomSplitter</span><span class="p">())</span>

    <span class="n">dls</span> <span class="o">=</span> <span class="n">dblock</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">wmt_df</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="n">bsz</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>

    <span class="c1"># 2. build your Learner</span>
    <span class="n">seq2seq_metrics</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">BaseModelWrapper</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span>
    <span class="n">fit_cbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">ShortEpochCallback</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">short_valid</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">Seq2SeqMetricsCallback</span><span class="p">(</span><span class="n">custom_metrics</span><span class="o">=</span><span class="n">seq2seq_metrics</span><span class="p">)]</span>

    <span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span>
        <span class="n">dls</span><span class="p">,</span>
        <span class="n">model</span><span class="p">,</span>
        <span class="n">opt_func</span><span class="o">=</span><span class="n">ranger</span><span class="p">,</span>
        <span class="n">loss_func</span><span class="o">=</span><span class="n">PreCalculatedCrossEntropyLoss</span><span class="p">(),</span>
        <span class="n">cbs</span><span class="o">=</span><span class="p">[</span><span class="n">BaseModelCallback</span><span class="p">],</span>
        <span class="n">splitter</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">blurr_seq2seq_splitter</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="n">hf_arch</span><span class="p">),</span>
    <span class="p">)</span><span class="o">.</span><span class="n">to_fp16</span><span class="p">()</span>

    <span class="n">learn</span><span class="o">.</span><span class="n">create_opt</span><span class="p">()</span>
    <span class="n">learn</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span>

    <span class="c1"># 3. Run your tests</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;*** TESTING DataLoaders ***</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">test_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">test_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;input_ids&quot;</span><span class="p">]),</span> <span class="n">bsz</span><span class="p">)</span>
        <span class="n">test_eq</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;input_ids&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="n">bsz</span><span class="p">,</span> <span class="n">inp_seq_sz</span><span class="p">]))</span>
        <span class="n">test_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">bsz</span><span class="p">)</span>

        <span class="c1">#         print(&#39;*** TESTING One pass through the model ***&#39;)</span>
        <span class="c1">#         preds = learn.model(b[0])</span>
        <span class="c1">#         test_eq(preds[1].shape[0], bsz)</span>
        <span class="c1">#         test_eq(preds[1].shape[2], hf_config.vocab_size)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;*** TESTING Training/Results ***&quot;</span><span class="p">)</span>
        <span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lr_max</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="n">fit_cbs</span><span class="p">)</span>

        <span class="n">test_results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hf_arch</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_tokenizer</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">&quot;PASSED&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">learn</span><span class="o">.</span><span class="n">show_results</span><span class="p">(</span><span class="n">learner</span><span class="o">=</span><span class="n">learn</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">input_trunc_at</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">target_trunc_at</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">test_results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hf_arch</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_tokenizer</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># cleanup</span>
        <span class="k">del</span> <span class="n">learn</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>arch</th>
      <th>tokenizer</th>
      <th>model_name</th>
      <th>result</th>
      <th>error</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>bart</td>
      <td>BartTokenizerFast</td>
      <td>BartForConditionalGeneration</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td>fsmt</td>
      <td>FSMTTokenizer</td>
      <td>FSMTForConditionalGeneration</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td>marian</td>
      <td>MarianTokenizer</td>
      <td>MarianMTModel</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>3</th>
      <td>t5</td>
      <td>T5TokenizerFast</td>
      <td>T5ForConditionalGeneration</td>
      <td>PASSED</td>
      <td></td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Summary">Summary<a class="anchor-link" href="#Summary"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This module includes the fundamental bits to use Blurr for translation tasks training and inference.</p>

</div>
</div>
</div>
</div>
 

