---

title: modeling.seq2seq.translation


keywords: fastai
sidebar: home_sidebar

summary: "This module contains custom models, custom splitters, etc... translation tasks."
description: "This module contains custom models, custom splitters, etc... translation tasks."
nb_path: "nbs/12_modeling-seq2seq-translation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/12_modeling-seq2seq-translation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>What we&#39;re running with at the time this documentation was generated:
torch: 1.10.2+cu102
fastai: 2.5.3
transformers: 4.16.2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">set_device</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Using GPU #</span><span class="si">{</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">current_device</span><span class="p">()</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">get_device_name</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Using GPU #1: GeForce GTX 1080 Ti
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Translation">Translation<a class="anchor-link" href="#Translation"> </a></h2><p>Translation tasks attempt to convert text in one language into another</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Prepare-the-data">Prepare the data<a class="anchor-link" href="#Prepare-the-data"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s1">&#39;wmt16&#39;</span><span class="p">,</span> <span class="s1">&#39;de-en&#39;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s1">&#39;train[:1%]&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Reusing dataset wmt16 (/home/wgilliam/.cache/huggingface/datasets/wmt16/de-en/1.0.0/af3c5d746b307726d0de73ebe7f10545361b9cb6f75c83a1734c000e48b6264f)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)</span>
<span class="n">wmt_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;translation&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;de&#39;</span><span class="p">,</span> <span class="s1">&#39;en&#39;</span><span class="p">]);</span> <span class="nb">len</span><span class="p">(</span><span class="n">wmt_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>45489</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">wmt_df</span> <span class="o">=</span> <span class="n">wmt_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">1000</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">wmt_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>de</th>
      <th>en</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Wiederaufnahme der Sitzungsperiode</td>
      <td>Resumption of the session</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Ich erkläre die am Freitag, dem 17. Dezember unterbrochene Sitzungsperiode des Europäischen Parlaments für wiederaufgenommen, wünsche Ihnen nochmals alles Gute zum Jahreswechsel und hoffe, daß Sie schöne Ferien hatten.</td>
      <td>I declare resumed the session of the European Parliament adjourned on Friday 17 December 1999, and I would like once again to wish you a happy new year in the hope that you enjoyed a pleasant festive period.</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pretrained_model_name</span> <span class="o">=</span> <span class="s2">&quot;Helsinki-NLP/opus-mt-de-en&quot;</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="n">AutoModelForSeq2SeqLM</span>

<span class="n">hf_arch</span><span class="p">,</span> <span class="n">hf_config</span><span class="p">,</span> <span class="n">hf_tokenizer</span><span class="p">,</span> <span class="n">hf_model</span> <span class="o">=</span> <span class="n">BLURR</span><span class="o">.</span><span class="n">get_hf_objects</span><span class="p">(</span><span class="n">pretrained_model_name</span><span class="p">,</span> <span class="n">model_cls</span><span class="o">=</span><span class="n">model_cls</span><span class="p">)</span>
<span class="n">hf_arch</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_tokenizer</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_config</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(&#39;marian&#39;,
 transformers.models.marian.tokenization_marian.MarianTokenizer,
 transformers.models.marian.configuration_marian.MarianConfig,
 transformers.models.marian.modeling_marian.MarianMTModel)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">blocks</span> <span class="o">=</span> <span class="p">(</span><span class="n">Seq2SeqTextBlock</span><span class="p">(</span><span class="n">hf_arch</span><span class="p">,</span> <span class="n">hf_config</span><span class="p">,</span> <span class="n">hf_tokenizer</span><span class="p">,</span> <span class="n">hf_model</span><span class="p">),</span> <span class="n">noop</span><span class="p">)</span>
<span class="n">dblock</span> <span class="o">=</span> <span class="n">DataBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">,</span> <span class="n">get_x</span><span class="o">=</span><span class="n">ColReader</span><span class="p">(</span><span class="s1">&#39;de&#39;</span><span class="p">),</span> <span class="n">get_y</span><span class="o">=</span><span class="n">ColReader</span><span class="p">(</span><span class="s1">&#39;en&#39;</span><span class="p">),</span> <span class="n">splitter</span><span class="o">=</span><span class="n">RandomSplitter</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span> <span class="o">=</span> <span class="n">dblock</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">wmt_df</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;input_ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(2, torch.Size([2, 141]), torch.Size([2, 101]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span><span class="o">.</span><span class="n">show_batch</span><span class="p">(</span><span class="n">dataloaders</span><span class="o">=</span><span class="n">dls</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">input_trunc_at</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">target_trunc_at</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>▁Angesichts▁dieser Situation▁muß▁aus dem▁Bericht, den das▁Parlament annimmt,▁klar▁hervorgehen,▁daß▁Maßnahmen▁notwendig▁sind, die▁eindeutig auf die▁Bekämpfung der relativen▁Armut und der Arbeitslosigkeit▁gerichtet▁sind.▁Maßnahmen▁wie die für diese▁Zwe</td>
      <td>Given this situation, the report approved by Parliament must highlight the need for measures that aim unequivocally to fight relative poverty and unemployment: measures such as the appropriate use of structural funds for these purposes, which are oft</td>
    </tr>
    <tr>
      <th>1</th>
      <td>▁Ich▁möchte▁daher die▁Kommission auf▁zwei▁Punkte▁hinweisen:▁Erstens▁muß die▁Konzertierung▁als Instrument der▁Koordinierung und der▁Beteiligung▁sämtlicher▁lokaler und▁regionaler▁Marktteilnehmer an den▁Entscheidungen optimal▁genutzt▁werden, um▁speziell</td>
      <td>Firstly, we need to make the best possible use of consultation as a means of ensuring proper coordination and participation by all local and regional operators in decision-making, precisely so that imbalances and inequalities can be avoided. Secondly</td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Train-model">Train model<a class="anchor-link" href="#Train-model"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">seq2seq_metrics</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;bleu&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;returns&#39;</span><span class="p">:</span> <span class="s2">&quot;bleu&quot;</span> <span class="p">},</span>
    <span class="s1">&#39;meteor&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;returns&#39;</span><span class="p">:</span> <span class="s2">&quot;meteor&quot;</span> <span class="p">},</span>
    <span class="s1">&#39;sacrebleu&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;returns&#39;</span><span class="p">:</span> <span class="s2">&quot;score&quot;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">BaseModelWrapper</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span>

<span class="n">learn_cbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">BaseModelCallback</span><span class="p">]</span>
<span class="n">fit_cbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Seq2SeqMetricsCallback</span><span class="p">(</span><span class="n">custom_metrics</span><span class="o">=</span><span class="n">seq2seq_metrics</span><span class="p">)]</span>

<span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> 
                <span class="n">model</span><span class="p">,</span>
                <span class="n">opt_func</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">Adam</span><span class="p">),</span>
                <span class="n">loss_func</span><span class="o">=</span><span class="n">CrossEntropyLossFlat</span><span class="p">(),</span> <span class="c1">#PreCalculatedLoss()</span>
                <span class="n">cbs</span><span class="o">=</span><span class="n">learn_cbs</span><span class="p">,</span>
                <span class="n">splitter</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">blurr_seq2seq_splitter</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="n">hf_arch</span><span class="p">))</span> <span class="c1">#.to_native_fp16() #.to_fp16()</span>

<span class="n">learn</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[nltk_data] Downloading package wordnet to /home/wgilliam/nltk_data...
[nltk_data]   Package wordnet is already up-to-date!
[nltk_data] Downloading package punkt to /home/wgilliam/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package omw-1.4 to /home/wgilliam/nltk_data...
[nltk_data]   Package omw-1.4 is already up-to-date!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># learn.summary()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># preds = learn.model(b[0])</span>

<span class="c1"># len(preds),preds[&#39;loss&#39;].shape, preds[&#39;logits&#39;].shape</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;input_ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(2, 3, torch.Size([2, 141]), 2, torch.Size([2, 101]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">param_groups</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">lr_find</span><span class="p">(</span><span class="n">suggest_funcs</span><span class="o">=</span><span class="p">[</span><span class="n">minimum</span><span class="p">,</span> <span class="n">steep</span><span class="p">,</span> <span class="n">valley</span><span class="p">,</span> <span class="n">slide</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "></div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>SuggestedLRs(minimum=8.317637839354575e-05, steep=1.0964781722577754e-06, valley=3.630780702224001e-05, slide=5.248074739938602e-05)</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lr_max</span><span class="o">=</span><span class="mf">4e-5</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="n">fit_cbs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>bleu</th>
      <th>meteor</th>
      <th>sacrebleu</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.364456</td>
      <td>1.188517</td>
      <td>0.316544</td>
      <td>0.620779</td>
      <td>31.041190</td>
      <td>00:45</td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">show_results</span><span class="p">(</span><span class="n">learner</span><span class="o">=</span><span class="n">learn</span><span class="p">,</span> <span class="n">input_trunc_at</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">target_trunc_at</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "></div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>target</th>
      <th>prediction</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>▁Aufgrund▁meinen▁Vorstellungen vom▁Aufbau▁Europas und von▁regionaler▁Entwicklungspolitik im▁besonderen▁halte▁ich das für eine Situation, die▁ich nicht▁akzeptieren▁kann.▁Ich▁habe die▁Absicht, im▁Rahmen▁meiner▁Möglichkeiten und mit▁Ihrer▁Unterstützung▁sämtliche Mittel, für die▁ich▁Verantwortung▁trage, für eine▁verbesserte▁soziale,▁menschliche und▁territoriale▁Kohäsion zu▁verwenden, um zu▁verhindern,▁daß es,▁wie▁ich es vor▁diesem▁Hause▁nannte, ein Europa der▁zwei▁Geschwindigkeiten▁gibt, ein Europa</td>
      <td>As far as I am concerned - taking into account my own concept of the construction of Europe and regional development policy in particular - this is a situation which I find unacceptable and I have every intention, as far as possible, with your support, of dedicating all the appropriations for which I am responsible to this improved social, human and territorial cohesion, particularly in order to prevent what I once called in this House a two-speed Europe, a Europe of wealthy districts but, at th</td>
      <td>On the basis of my ideas about the construction of Europe and of regional development policy in particular, I consider this to be a situation which I cannot accept, and I intend, within my possibilities and with your support, to use all the means for which I am responsible, in order to improve social, human and territorial cohesion in order to prevent, as I called it before this House, a Europe of two speeds, a Europe of chic neighbourhoods and a Europe of poor suburbs.</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Frau▁Präsidentin! Wir▁können und▁dürfen▁uns nicht▁damit▁abfinden,▁immer▁häufiger von▁Unfällen zu▁hören,▁bei▁denen auf der Straße,▁aber▁auch auf der▁Schiene oder auf Wasserwegen▁große▁Schäden▁entstehen, nicht▁nur,▁aber▁auch,▁weil die▁Betroffenen den Transit von▁gefährlichen▁Gütern nicht▁ernst▁genug▁nehmen oder▁weil durch Unwissen oder▁aufgrund▁mangelnder▁Ausbildung der▁Fahrer oder▁sonstiger▁Verantwortlicher für die▁diversen▁Verkehrsmittel▁aus▁einem▁kleinen▁Unfall▁allzu▁oft eine▁große▁Katastrophe▁</td>
      <td>Madam President, we cannot and must not accept the fact that we hear ever more frequently of accidents causing major damage on our roads, but also on our railways and waterways, not solely but at least partly because those involved do not take the transport of dangerous goods seriously enough or because - as a result of ignorance or a lack of training on the part of the drivers or others responsible for the various vehicles - a minor accident has all too often become a major disaster.</td>
      <td>Madam President, we cannot and must not accept the fact that there is an increasing number of accidents involving serious damage to the road, rail or waterways, not only, but also because the persons concerned do not take the transit of dangerous goods seriously enough, or because all too often a major disaster has been caused by ignorance or lack of training of drivers or other persons responsible for the various modes of transport resulting from a small accident.</td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_de</span> <span class="o">=</span> <span class="s2">&quot;Ich trinke gerne Bier&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">outputs</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">blurr_generate</span><span class="p">(</span><span class="n">test_de</span><span class="p">,</span> <span class="n">num_return_sequences</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">outputs</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;=== Prediction </span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1"> ===</span><span class="se">\n</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>=== Prediction 1 ===
I like to drink beer

=== Prediction 2 ===
I like to drink beer.

=== Prediction 3 ===
I like to drink

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Inference">Inference<a class="anchor-link" href="#Inference"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">export_fname</span> <span class="o">=</span> <span class="s1">&#39;translation_export&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">learn</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">export_fname</span><span class="si">}</span><span class="s1">.pkl&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inf_learn</span> <span class="o">=</span> <span class="n">load_learner</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">export_fname</span><span class="si">}</span><span class="s1">.pkl&#39;</span><span class="p">)</span>
<span class="n">inf_learn</span><span class="o">.</span><span class="n">blurr_generate</span><span class="p">(</span><span class="n">test_de</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;I like to drink beer&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="High-level-API">High-level API<a class="anchor-link" href="#High-level-API"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="BlearnerForTranslation">BlearnerForTranslation<a class="anchor-link" href="#BlearnerForTranslation"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We also introduce a task specific <a href="/blurr/modeling-core.html#Blearner"><code>Blearner</code></a> that get you your DataBlock, DataLoaders, and BLearner in one line of code!</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BlearnerForTranslation" class="doc_header"><code>class</code> <code>BlearnerForTranslation</code><a href="https://github.com/ohmeow/blurr/tree/master/blurr/modeling/seq2seq/translation.py#L35" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BlearnerForTranslation</code>(<strong><code>dls</code></strong>:<code>DataLoaders</code>, <strong><code>hf_model</code></strong>:<code>PreTrainedModel</code>, <strong><code>base_model_cb</code></strong>:<a href="/blurr/modeling-core.html#BaseModelCallback"><code>BaseModelCallback</code></a>=<em><code>BaseModelCallback</code></em>, <strong><code>loss_func</code></strong>=<em><code>None</code></em>, <strong><code>opt_func</code></strong>=<em><code>Adam</code></em>, <strong><code>lr</code></strong>=<em><code>0.001</code></em>, <strong><code>splitter</code></strong>=<em><code>trainable_params</code></em>, <strong><code>cbs</code></strong>=<em><code>None</code></em>, <strong><code>metrics</code></strong>=<em><code>None</code></em>, <strong><code>path</code></strong>=<em><code>None</code></em>, <strong><code>model_dir</code></strong>=<em><code>'models'</code></em>, <strong><code>wd</code></strong>=<em><code>None</code></em>, <strong><code>wd_bn_bias</code></strong>=<em><code>False</code></em>, <strong><code>train_bn</code></strong>=<em><code>True</code></em>, <strong><code>moms</code></strong>=<em><code>(0.95, 0.85, 0.95)</code></em>) :: <a href="/blurr/modeling-core.html#Blearner"><code>Blearner</code></a></p>
</blockquote>
<p>Group together a <code>model</code>, some <code>dls</code> and a <code>loss_func</code> to handle training</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">BlearnerForTranslation</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">wmt_df</span><span class="p">,</span> <span class="s1">&#39;Helsinki-NLP/opus-mt-de-en&#39;</span><span class="p">,</span> 
                                              <span class="n">src_lang_name</span><span class="o">=</span><span class="s1">&#39;German&#39;</span><span class="p">,</span> <span class="n">src_lang_attr</span><span class="o">=</span><span class="s1">&#39;de&#39;</span><span class="p">,</span> 
                                              <span class="n">trg_lang_name</span><span class="o">=</span><span class="s1">&#39;English&#39;</span><span class="p">,</span> <span class="n">trg_lang_attr</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> 
                                              <span class="n">dblock_splitter</span><span class="o">=</span><span class="n">RandomSplitter</span><span class="p">(),</span>
                                              <span class="n">dl_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bs&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">metrics_cb</span> <span class="o">=</span> <span class="n">BlearnerForTranslation</span><span class="o">.</span><span class="n">get_metrics_cb</span><span class="p">()</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lr_max</span><span class="o">=</span><span class="mf">4e-5</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="p">[</span><span class="n">metrics_cb</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[nltk_data] Downloading package wordnet to /home/wgilliam/nltk_data...
[nltk_data]   Package wordnet is already up-to-date!
[nltk_data] Downloading package punkt to /home/wgilliam/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package omw-1.4 to /home/wgilliam/nltk_data...
[nltk_data]   Package omw-1.4 is already up-to-date!
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>bleu</th>
      <th>meteor</th>
      <th>sacrebleu</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.244795</td>
      <td>1.311637</td>
      <td>0.325591</td>
      <td>0.586610</td>
      <td>31.701792</td>
      <td>00:46</td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">show_results</span><span class="p">(</span><span class="n">learner</span><span class="o">=</span><span class="n">learn</span><span class="p">,</span> <span class="n">input_trunc_at</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">target_trunc_at</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "></div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>target</th>
      <th>prediction</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Sie▁wird▁aber auf▁Seite 5▁dieser▁Leitlinien▁ganz▁eindeutig▁genannt, und▁ich▁möchte▁darauf▁verweisen -▁weil▁sie▁mich▁dazu▁aufgefordert▁haben -,▁daß diese▁Partnerschaft für▁mich - und▁ich▁habe▁lange▁genug eine Region▁betreut, um dies▁beurteilen zu▁können - ein▁sehr▁wirkungsvolles Instrument zur▁Mobilisierung der▁geistigen▁Ressourcen auf▁lokaler▁Ebene▁ist -▁sowohl derer im▁öffentlichen▁Sektor - die Stadt- und▁Gemeinderäte, den▁schulischen und▁gesellschaftlichen▁Bereich, die▁Vereine und▁Verbände -▁a</td>
      <td>However, I do wish to mention - since you have asked me to do so - that, as far as I am concerned, this partnership - and I spent long enough as a regional administrator within my own country to be able to say this most sincerely - is a tool, one use</td>
      <td>However, it is clearly mentioned on page 5 of these guidelines, and I would like to point out - because they have asked me to do so - that this partnership is a very effective instrument for me - and I have maintained a region long enough to be able</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Vor▁allen▁Dingen▁besteht die▁Gefahr,▁daß die - in▁vielerlei▁Hinsicht▁notwendige -▁Verlagerung der▁Zuständigkeiten auf die▁einzelstaatliche▁Ebene▁dazu▁führt,▁daß▁Maßnahmen im▁Bereich des▁Wettbewerbs▁enorm▁zunehmen und die▁Versuchung▁besteht, das▁Kartellverbot nicht▁als▁letztinstanzliche▁Garantie für das▁einwandfreie und▁vorhersehbare▁Funktionieren der▁Märkte▁einzusetzen,▁sondern▁als▁wirtschafts- und industriepolitisches Instrument,▁als Instrument der▁Planung und des▁Eingreifens in die▁spontanen▁E</td>
      <td>First of all, there is a risk that the decentralisation of powers, though necessary in many ways, will cause an abnormal increase in competition-related initiatives, and that some people will be tempted to use competition law, not as a means to be re</td>
      <td>Above all, there is a risk that the transfer of responsibilities to the national level, which is necessary in many respects, will result in an enormous increase in competition measures and the temptation to use the ban on cartels not as a last resort</td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_de</span> <span class="o">=</span> <span class="s2">&quot;Ich trinke gerne Bier&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">blurr_generate</span><span class="p">(</span><span class="n">test_de</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;I like to drink beer&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">export_fname</span> <span class="o">=</span> <span class="s1">&#39;translation_export&#39;</span>

<span class="n">learn</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">to_fp32</span><span class="p">()</span>
<span class="n">learn</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">export_fname</span><span class="si">}</span><span class="s1">.pkl&#39;</span><span class="p">)</span>

<span class="n">inf_learn</span> <span class="o">=</span> <span class="n">load_learner</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">export_fname</span><span class="si">}</span><span class="s1">.pkl&#39;</span><span class="p">)</span>
<span class="n">inf_learn</span><span class="o">.</span><span class="n">blurr_generate</span><span class="p">(</span><span class="n">test_de</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;I like to drink beer&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Tests">Tests<a class="anchor-link" href="#Tests"> </a></h2><p>The purpose of the following tests is to ensure as much as possible, that the core training code works for the pretrained <strong>translation models</strong> below.  These tests are excluded from the CI workflow because of how long they would take to run and the amount of data that would be required to download.</p>
<p><strong>Note</strong>: Feel free to modify the code below to test whatever pretrained summarization models you are working with ... and if any of your pretrained translation models fail, please submit a github issue <em>(or a PR if you'd like to fix it yourself)</em></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span> <span class="k">del</span> <span class="n">learn</span><span class="p">;</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[</span> <span class="n">model_type</span> <span class="k">for</span> <span class="n">model_type</span> <span class="ow">in</span> <span class="n">BLURR</span><span class="o">.</span><span class="n">get_models</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;ConditionalGeneration&#39;</span><span class="p">)</span> 
 <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">model_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;TF&#39;</span><span class="p">))</span> <span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;BartForConditionalGeneration&#39;,
 &#39;BigBirdPegasusForConditionalGeneration&#39;,
 &#39;BlenderbotForConditionalGeneration&#39;,
 &#39;BlenderbotSmallForConditionalGeneration&#39;,
 &#39;FSMTForConditionalGeneration&#39;,
 &#39;LEDForConditionalGeneration&#39;,
 &#39;M2M100ForConditionalGeneration&#39;,
 &#39;MBartForConditionalGeneration&#39;,
 &#39;MT5ForConditionalGeneration&#39;,
 &#39;PegasusForConditionalGeneration&#39;,
 &#39;ProphetNetForConditionalGeneration&#39;,
 &#39;Speech2TextForConditionalGeneration&#39;,
 &#39;T5ForConditionalGeneration&#39;,
 &#39;XLMProphetNetForConditionalGeneration&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pretrained_model_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;facebook/bart-base&#39;</span><span class="p">,</span>
    <span class="s1">&#39;facebook/wmt19-de-en&#39;</span><span class="p">,</span>                      <span class="c1"># FSMT</span>
    <span class="s1">&#39;Helsinki-NLP/opus-mt-de-en&#39;</span><span class="p">,</span>                <span class="c1"># MarianMT</span>
    <span class="c1">#&#39;sshleifer/tiny-mbart&#39;,</span>
    <span class="c1">#&#39;google/mt5-small&#39;,</span>
    <span class="s1">&#39;t5-small&#39;</span>
<span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s1">&#39;wmt16&#39;</span><span class="p">,</span> <span class="s1">&#39;de-en&#39;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s1">&#39;train[:1%]&#39;</span><span class="p">)</span>
<span class="n">wmt_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;translation&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;de&#39;</span><span class="p">,</span> <span class="s1">&#39;en&#39;</span><span class="p">]);</span> <span class="nb">len</span><span class="p">(</span><span class="n">wmt_df</span><span class="p">)</span>
<span class="n">wmt_df</span> <span class="o">=</span> <span class="n">wmt_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">1000</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Reusing dataset wmt16 (/home/wgilliam/.cache/huggingface/datasets/wmt16/de-en/1.0.0/af3c5d746b307726d0de73ebe7f10545361b9cb6f75c83a1734c000e48b6264f)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#hide_output</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="n">AutoModelForSeq2SeqLM</span>
<span class="n">bsz</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">inp_seq_sz</span> <span class="o">=</span> <span class="mi">128</span><span class="p">;</span> <span class="n">trg_seq_sz</span> <span class="o">=</span> <span class="mi">128</span>

<span class="n">test_results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="n">pretrained_model_names</span><span class="p">:</span>
    <span class="n">error</span><span class="o">=</span><span class="kc">None</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;=== </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1"> ===</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="n">hf_tok_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;sshleifer/tiny-mbart&#39;</span><span class="p">):</span>
        <span class="n">hf_tok_kwargs</span><span class="p">[</span><span class="s1">&#39;src_lang&#39;</span><span class="p">],</span> <span class="n">hf_tok_kwargs</span><span class="p">[</span><span class="s1">&#39;tgt_lang&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;de_DE&quot;</span><span class="p">,</span> <span class="s2">&quot;en_XX&quot;</span>
            
    
    <span class="n">hf_arch</span><span class="p">,</span> <span class="n">hf_config</span><span class="p">,</span> <span class="n">hf_tokenizer</span><span class="p">,</span> <span class="n">hf_model</span> <span class="o">=</span> <span class="n">BLURR</span><span class="o">.</span><span class="n">get_hf_objects</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> 
                                                                      <span class="n">model_cls</span><span class="o">=</span><span class="n">model_cls</span><span class="p">,</span> 
                                                                      <span class="n">tokenizer_kwargs</span><span class="o">=</span><span class="n">hf_tok_kwargs</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;architecture:</span><span class="se">\t</span><span class="si">{</span><span class="n">hf_arch</span><span class="si">}</span><span class="se">\n</span><span class="s1">tokenizer:</span><span class="se">\t</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">hf_tokenizer</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="se">\n</span><span class="s1">model:</span><span class="se">\t\t</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="c1"># 1. build your DataBlock</span>
    <span class="n">text_gen_kwargs</span> <span class="o">=</span> <span class="n">default_text_gen_kwargs</span><span class="p">(</span><span class="n">hf_config</span><span class="p">,</span> <span class="n">hf_model</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="s1">&#39;translation&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">add_t5_prefix</span><span class="p">(</span><span class="n">inp</span><span class="p">):</span> <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;translate German to English: </span><span class="si">{</span><span class="n">inp</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="p">(</span><span class="n">hf_arch</span> <span class="o">==</span> <span class="s1">&#39;t5&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">inp</span>
    
    <span class="n">batch_tokenize_tfm</span> <span class="o">=</span> <span class="n">Seq2SeqBatchTokenizeTransform</span><span class="p">(</span><span class="n">hf_arch</span><span class="p">,</span> <span class="n">hf_config</span><span class="p">,</span> <span class="n">hf_tokenizer</span><span class="p">,</span> <span class="n">hf_model</span><span class="p">,</span>
                                                      <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;max_length&#39;</span><span class="p">,</span> 
                                                      <span class="n">max_length</span><span class="o">=</span><span class="n">inp_seq_sz</span><span class="p">,</span> 
                                                      <span class="n">max_target_length</span><span class="o">=</span><span class="n">trg_seq_sz</span><span class="p">,</span> 
                                                      <span class="n">text_gen_kwargs</span><span class="o">=</span><span class="n">text_gen_kwargs</span><span class="p">)</span>
    
    <span class="n">blocks</span> <span class="o">=</span> <span class="p">(</span><span class="n">Seq2SeqTextBlock</span><span class="p">(</span><span class="n">batch_tokenize_tfm</span><span class="o">=</span><span class="n">batch_tokenize_tfm</span><span class="p">),</span> <span class="n">noop</span><span class="p">)</span>
    <span class="n">dblock</span> <span class="o">=</span> <span class="n">DataBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">,</span> 
                   <span class="n">get_x</span><span class="o">=</span><span class="n">Pipeline</span><span class="p">([</span><span class="n">ColReader</span><span class="p">(</span><span class="s1">&#39;de&#39;</span><span class="p">),</span> <span class="n">add_t5_prefix</span><span class="p">]),</span> 
                   <span class="n">get_y</span><span class="o">=</span><span class="n">ColReader</span><span class="p">(</span><span class="s1">&#39;en&#39;</span><span class="p">),</span> 
                   <span class="n">splitter</span><span class="o">=</span><span class="n">RandomSplitter</span><span class="p">())</span>

    <span class="n">dls</span> <span class="o">=</span> <span class="n">dblock</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">wmt_df</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="n">bsz</span><span class="p">)</span> 
    <span class="n">b</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>

    <span class="c1"># 2. build your Learner</span>
    <span class="n">seq2seq_metrics</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="n">model</span> <span class="o">=</span> <span class="n">BaseModelWrapper</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span>
    <span class="n">fit_cbs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">ShortEpochCallback</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">short_valid</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> 
        <span class="n">Seq2SeqMetricsCallback</span><span class="p">(</span><span class="n">custom_metrics</span><span class="o">=</span><span class="n">seq2seq_metrics</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> 
                    <span class="n">model</span><span class="p">,</span>
                    <span class="n">opt_func</span><span class="o">=</span><span class="n">ranger</span><span class="p">,</span>
                    <span class="n">loss_func</span><span class="o">=</span><span class="n">PreCalculatedLoss</span><span class="p">(),</span>
                    <span class="n">cbs</span><span class="o">=</span><span class="p">[</span><span class="n">BaseModelCallback</span><span class="p">],</span>
                    <span class="n">splitter</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">blurr_seq2seq_splitter</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="n">hf_arch</span><span class="p">))</span><span class="o">.</span><span class="n">to_fp16</span><span class="p">()</span>

    <span class="n">learn</span><span class="o">.</span><span class="n">create_opt</span><span class="p">()</span> 
    <span class="n">learn</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span>
    
    <span class="c1"># 3. Run your tests</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*** TESTING DataLoaders ***</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">test_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">test_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;input_ids&#39;</span><span class="p">]),</span> <span class="n">bsz</span><span class="p">)</span>
        <span class="n">test_eq</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;input_ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="n">bsz</span><span class="p">,</span> <span class="n">inp_seq_sz</span><span class="p">]))</span>
        <span class="n">test_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">bsz</span><span class="p">)</span>

<span class="c1">#         print(&#39;*** TESTING One pass through the model ***&#39;)</span>
<span class="c1">#         preds = learn.model(b[0])</span>
<span class="c1">#         test_eq(preds[1].shape[0], bsz)</span>
<span class="c1">#         test_eq(preds[1].shape[2], hf_config.vocab_size)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*** TESTING Training/Results ***&#39;</span><span class="p">)</span>
        <span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lr_max</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="n">fit_cbs</span><span class="p">)</span>

        <span class="n">test_results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hf_arch</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_tokenizer</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;PASSED&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="n">learn</span><span class="o">.</span><span class="n">show_results</span><span class="p">(</span><span class="n">learner</span><span class="o">=</span><span class="n">learn</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">input_trunc_at</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">target_trunc_at</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">test_results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hf_arch</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_tokenizer</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;FAILED&#39;</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># cleanup</span>
        <span class="k">del</span> <span class="n">learn</span><span class="p">;</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>arch</th>
      <th>tokenizer</th>
      <th>model_name</th>
      <th>result</th>
      <th>error</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>bart</td>
      <td>BartTokenizerFast</td>
      <td>BartForConditionalGeneration</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td>fsmt</td>
      <td>FSMTTokenizer</td>
      <td>FSMTForConditionalGeneration</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td>marian</td>
      <td>MarianTokenizer</td>
      <td>MarianMTModel</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>3</th>
      <td>t5</td>
      <td>T5TokenizerFast</td>
      <td>T5ForConditionalGeneration</td>
      <td>PASSED</td>
      <td></td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Summary">Summary<a class="anchor-link" href="#Summary"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This module includes the fundamental bits to use Blurr for translation tasks training and inference.</p>

</div>
</div>
</div>
</div>
 

