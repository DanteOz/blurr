---

title: modeling.token_classification


keywords: fastai
sidebar: home_sidebar

summary: "This module contains custom models, loss functions, custom splitters, etc... for token classification tasks (e.g., Named entity recognition (NER), Part-of-speech tagging (POS), etc...). The objective of token classification is to predict the correct label for each token provided in the input. In the computer vision world, this is akin to what we do in segmentation tasks whereby we attempt to predict the class/label for each pixel in an image."
description: "This module contains custom models, loss functions, custom splitters, etc... for token classification tasks (e.g., Named entity recognition (NER), Part-of-speech tagging (POS), etc...). The objective of token classification is to predict the correct label for each token provided in the input. In the computer vision world, this is akin to what we do in segmentation tasks whereby we attempt to predict the class/label for each pixel in an image."
nb_path: "nbs/03_modeling-token-classification.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/03_modeling-token-classification.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>What we&#39;re running with at the time this documentation was generated:
torch: 1.10.2+cu102
fastai: 2.5.3
transformers: 4.16.2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setup">Setup<a class="anchor-link" href="#Setup"> </a></h2><p>We'll use a subset of <code>conll2003</code> to demonstrate how to configure your BLURR code for token classification</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">raw_datasets</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;conll2003&quot;</span><span class="p">)</span>

<span class="n">labels</span> <span class="o">=</span> <span class="n">raw_datasets</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;ner_tags&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">names</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Labels: </span><span class="si">{labels}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">conll2003_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">raw_datasets</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">])</span>
<span class="n">conll2003_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Reusing dataset conll2003 (/home/wgilliam/.cache/huggingface/datasets/conll2003/conll2003/1.0.0/40e7cb6bcc374f7c349c83acd1e9352a4f09474eb691f64f364ee62eb65d0ca6)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Labels: [&#39;O&#39;, &#39;B-PER&#39;, &#39;I-PER&#39;, &#39;B-ORG&#39;, &#39;I-ORG&#39;, &#39;B-LOC&#39;, &#39;I-LOC&#39;, &#39;B-MISC&#39;, &#39;I-MISC&#39;]
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>chunk_tags</th>
      <th>id</th>
      <th>ner_tags</th>
      <th>pos_tags</th>
      <th>tokens</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[11, 21, 11, 12, 21, 22, 11, 12, 0]</td>
      <td>0</td>
      <td>[3, 0, 7, 0, 0, 0, 7, 0, 0]</td>
      <td>[22, 42, 16, 21, 35, 37, 16, 21, 7]</td>
      <td>[EU, rejects, German, call, to, boycott, British, lamb, .]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[11, 12]</td>
      <td>1</td>
      <td>[1, 2]</td>
      <td>[22, 22]</td>
      <td>[Peter, Blackburn]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[11, 12]</td>
      <td>2</td>
      <td>[5, 0]</td>
      <td>[22, 11]</td>
      <td>[BRUSSELS, 1996-08-22]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[11, 12, 12, 21, 13, 11, 11, 21, 13, 11, 12, 13, 11, 21, 22, 11, 12, 17, 11, 21, 17, 11, 12, 12, 21, 22, 22, 13, 11, 0]</td>
      <td>3</td>
      <td>[0, 3, 4, 0, 0, 0, 0, 0, 0, 7, 0, 0, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</td>
      <td>[12, 22, 22, 38, 15, 22, 28, 38, 15, 16, 21, 35, 24, 35, 37, 16, 21, 15, 24, 41, 15, 16, 21, 21, 20, 37, 40, 35, 21, 7]</td>
      <td>[The, European, Commission, said, on, Thursday, it, disagreed, with, German, advice, to, consumers, to, shun, British, lamb, until, scientists, determine, whether, mad, cow, disease, can, be, transmitted, to, sheep, .]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[11, 11, 12, 13, 11, 12, 12, 11, 12, 12, 12, 12, 21, 13, 11, 12, 21, 22, 11, 13, 11, 1, 13, 11, 17, 11, 12, 12, 21, 1, 0]</td>
      <td>4</td>
      <td>[5, 0, 0, 0, 0, 3, 4, 0, 0, 0, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0]</td>
      <td>[22, 27, 21, 35, 12, 22, 22, 27, 16, 21, 22, 22, 38, 15, 22, 24, 20, 37, 21, 15, 24, 16, 15, 22, 15, 12, 16, 21, 38, 17, 7]</td>
      <td>[Germany, 's, representative, to, the, European, Union, 's, veterinary, committee, Werner, Zwingmann, said, on, Wednesday, consumers, should, buy, sheepmeat, from, countries, other, than, Britain, until, the, scientific, advice, was, clearer, .]</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_cls</span> <span class="o">=</span> <span class="n">AutoModelForTokenClassification</span>
<span class="n">pretrained_model_name</span> <span class="o">=</span> <span class="s2">&quot;roberta-base&quot;</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">AutoConfig</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">pretrained_model_name</span><span class="p">)</span>

<span class="n">config</span><span class="o">.</span><span class="n">num_labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
<span class="n">hf_arch</span><span class="p">,</span> <span class="n">hf_config</span><span class="p">,</span> <span class="n">hf_tokenizer</span><span class="p">,</span> <span class="n">hf_model</span> <span class="o">=</span> <span class="n">BLURR</span><span class="o">.</span><span class="n">get_hf_objects</span><span class="p">(</span><span class="n">pretrained_model_name</span><span class="p">,</span> <span class="n">model_cls</span><span class="o">=</span><span class="n">model_cls</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
<span class="n">hf_arch</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_config</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_tokenizer</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(&#39;roberta&#39;,
 transformers.models.roberta.configuration_roberta.RobertaConfig,
 transformers.models.roberta.tokenization_roberta_fast.RobertaTokenizerFast,
 transformers.models.roberta.modeling_roberta.RobertaForTokenClassification)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Note</strong>: Make sure you set the <code>config.num_labels</code> attribute to the number of labels your model is predicting. The model will update its last layer accordingly as la transfer learning.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">hf_config</span><span class="o">.</span><span class="n">num_labels</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">batch_tok_tfm</span> <span class="o">=</span> <span class="n">TokenClassBatchTokenizeTransform</span><span class="p">(</span><span class="n">hf_arch</span><span class="p">,</span> <span class="n">hf_config</span><span class="p">,</span> <span class="n">hf_tokenizer</span><span class="p">,</span> <span class="n">hf_model</span><span class="p">)</span>
<span class="n">blocks</span> <span class="o">=</span> <span class="p">(</span><span class="n">TextBlock</span><span class="p">(</span><span class="n">batch_tokenize_tfm</span><span class="o">=</span><span class="n">batch_tok_tfm</span><span class="p">,</span> <span class="n">input_return_type</span><span class="o">=</span><span class="n">TokenClassTextInput</span><span class="p">),</span> <span class="n">TokenCategoryBlock</span><span class="p">(</span><span class="n">vocab</span><span class="o">=</span><span class="n">labels</span><span class="p">))</span>

<span class="n">dblock</span> <span class="o">=</span> <span class="n">DataBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">,</span> <span class="n">get_x</span><span class="o">=</span><span class="n">ColReader</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">),</span> <span class="n">get_y</span><span class="o">=</span><span class="n">ColReader</span><span class="p">(</span><span class="s2">&quot;ner_tags&quot;</span><span class="p">),</span> <span class="n">splitter</span><span class="o">=</span><span class="n">RandomSplitter</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span> <span class="o">=</span> <span class="n">dblock</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">conll2003_df</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span><span class="o">.</span><span class="n">show_batch</span><span class="p">(</span><span class="n">dataloaders</span><span class="o">=</span><span class="n">dls</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>word / target label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[('MARKET', 'O'), ('TALK', 'O'), ('-', 'O'), ('USDA', 'B-ORG'), ('net', 'O'), ('change', 'O'), ('in', 'O'), ('weekly', 'O'), ('export', 'O'), ('commitments', 'O'), ('for', 'O'), ('the', 'O'), ('week', 'O'), ('ended', 'O'), ('August', 'O'), ('22', 'O'), (',', 'O'), ('includes', 'O'), ('old', 'O'), ('crop', 'O'), ('and', 'O'), ('new', 'O'), ('crop', 'O'), (',', 'O'), ('were', 'O'), (':', 'O'), ('wheat', 'O'), ('up', 'O'), ('595,400', 'O'), ('tonnes', 'O'), ('old', 'O'), (',', 'O'), ('nil', 'O'), ('new', 'O'), (';', 'O'), ('corn', 'O'), ('up', 'O'), ('1,900', 'O'), ('old', 'O'), (',', 'O'), ('up', 'O'), ('319,600', 'O'), ('new', 'O'), (';', 'O'), ('soybeans', 'O'), ('down', 'O'), ('12,300', 'O'), ('old', 'O'), (',', 'O'), ('up', 'O'), ('300,800', 'O'), ('new', 'O'), (';', 'O'), ('upland', 'O'), ('cotton', 'O'), ('up', 'O'), ('50,400', 'O'), ('bales', 'O'), ('new', 'O'), (',', 'O'), ('nil', 'O'), ('old', 'O'), (';', 'O'), ('soymeal', 'O'), ('54,800', 'O'), ('old', 'O'), (',', 'O'), ('up', 'O'), ('100,600', 'O'), ('new', 'O'), (',', 'O'), ('soyoil', 'O'), ('nil', 'O'), ('old', 'O'), (',', 'O'), ('up', 'O'), ('75,000', 'O'), ('new', 'O'), (';', 'O'), ('barley', 'O'), ('up', 'O'), ('1,700', 'O'), ('old', 'O'), (',', 'O'), ('nil', 'O'), ('new', 'O'), (';', 'O'), ('sorghum', 'O'), ('6,200', 'O'), ('old', 'O'), (',', 'O'), ('up', 'O'), ('156,700', 'O'), ('new', 'O'), (';', 'O'), ('pima', 'O'), ('cotton', 'O'), ('up', 'O'), ('4,000', 'O'), ('bales', 'O'), ('old', 'O'), (',', 'O'), ('nil', 'O'), ('new', 'O'), (';', 'O'), ('rice', 'O'), ('up', 'O'), ('49,900', 'O'), ('old', 'O'), (',', 'O'), ('nil', 'O'), ('new', 'O'), ('...', 'O')]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[('Boston', 'B-ORG'), ("'s", 'O'), ('Roger', 'B-PER'), ('Clemens', 'I-PER'), ('(', 'O'), ('7-11', 'O'), (')', 'O'), ('was', 'O'), ('one', 'O'), ('out', 'O'), ('away', 'O'), ('from', 'O'), ('his', 'O'), ('second', 'O'), ('straight', 'O'), ('shutout', 'O'), ('when', 'O'), ('pinch-hitter', 'O'), ('Matt', 'B-PER'), ('Stairs', 'I-PER'), ('tripled', 'O'), ('over', 'O'), ('the', 'O'), ('head', 'O'), ('of', 'O'), ('centre', 'O'), ('fielder', 'O'), ('Lee', 'B-PER'), ('Tinsley', 'I-PER'), ('on', 'O'), ('an', 'O'), ('0-2', 'O'), ('pitch', 'O'), ('and', 'O'), ('pinch-hitter', 'O'), ('Terry', 'B-PER'), ('Steinbach', 'I-PER'), ('dunked', 'O'), ('a', 'O'), ('broken-bat', 'O'), ('single', 'O'), ('into', 'O'), ('right', 'O'), ('to', 'O'), ('lift', 'O'), ('Oakland', 'B-ORG'), ('into', 'O'), ('a', 'O'), ('1-1', 'O'), ('tie', 'O'), ('.', 'O')]</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Metrics">Metrics<a class="anchor-link" href="#Metrics"> </a></h2><p>In this section, we'll add helpful metrics for token classification tasks</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calculate_token_class_metrics" class="doc_header"><code>calculate_token_class_metrics</code><a href="https://github.com/ohmeow/blurr/tree/master/blurr/modeling/token_classification.py#L42" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calculate_token_class_metrics</code>(<strong><code>pred_toks</code></strong>, <strong><code>targ_toks</code></strong>, <strong><code>metric_key</code></strong>)</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><p><strong><code>pred_toks</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></p>
</li>
<li><p><strong><code>targ_toks</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></p>
</li>
<li><p><strong><code>metric_key</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></p>
</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="TokenClassMetricsCallback"><a href="/blurr/modeling-token-classification.html#TokenClassMetricsCallback"><code>TokenClassMetricsCallback</code></a><a class="anchor-link" href="#TokenClassMetricsCallback"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TokenClassMetricsCallback" class="doc_header"><code>class</code> <code>TokenClassMetricsCallback</code><a href="https://github.com/ohmeow/blurr/tree/master/blurr/modeling/token_classification.py#L60" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TokenClassMetricsCallback</code>(<strong><code>tok_metrics</code></strong>=<em><code>['accuracy', 'precision', 'recall', 'f1']</code></em>, <strong>**<code>kwargs</code></strong>) :: <code>Callback</code></p>
</blockquote>
<p>A fastai friendly callback that includes accuracy, precision, recall, and f1 metrics using the
<code>seqeval</code> library.  Additionally, this metric knows how to <em>not</em> include your 'ignore_token' in it's
calculations.</p>
<p>See <a href="https://github.com/chakki-works/seqeval">here</a> for more information on <code>seqeval</code>.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><p><strong><code>tok_metrics</code></strong> : <em><code>&lt;class 'list'&gt;</code></em>, <em>optional</em></p>
</li>
<li><p><strong><code>kwargs</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></p>
</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Mid-level-API">Mid-level API<a class="anchor-link" href="#Mid-level-API"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Training">Training<a class="anchor-link" href="#Training"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">BaseModelWrapper</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span>
<span class="n">learn_cbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">BaseModelCallback</span><span class="p">]</span>
<span class="n">fit_cbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">TokenClassMetricsCallback</span><span class="p">()]</span>

<span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">opt_func</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">Adam</span><span class="p">),</span> <span class="n">cbs</span><span class="o">=</span><span class="n">learn_cbs</span><span class="p">,</span> <span class="n">splitter</span><span class="o">=</span><span class="n">blurr_splitter</span><span class="p">)</span>

<span class="n">learn</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># learn.summary()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">len</span><span class="p">(</span><span class="n">preds</span><span class="p">),</span> <span class="n">preds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(1, torch.Size([4, 156, 9]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;input_ids&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(2, 2, torch.Size([4, 156]), 4, torch.Size([4, 156]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">preds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">preds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">preds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">preds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>torch.Size([624, 9]) torch.Size([624])
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">param_groups</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">unfreeze</span><span class="p">()</span>
<span class="n">learn</span><span class="o">.</span><span class="n">lr_find</span><span class="p">(</span><span class="n">suggest_funcs</span><span class="o">=</span><span class="p">[</span><span class="n">minimum</span><span class="p">,</span> <span class="n">steep</span><span class="p">,</span> <span class="n">valley</span><span class="p">,</span> <span class="n">slide</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>SuggestedLRs(minimum=0.0013182567432522773, steep=0.0002754228771664202, valley=0.0002290867705596611, slide=0.0010000000474974513)</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lr_max</span><span class="o">=</span><span class="mf">3e-5</span><span class="p">,</span> <span class="n">moms</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="n">cbs</span><span class="o">=</span><span class="n">fit_cbs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>precision</th>
      <th>recall</th>
      <th>f1</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.065136</td>
      <td>0.043449</td>
      <td>0.989530</td>
      <td>0.937927</td>
      <td>0.931568</td>
      <td>0.934736</td>
      <td>03:16</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">token_classification_report</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>              precision    recall  f1-score   support

         LOC       0.96      0.95      0.96      1441
        MISC       0.85      0.84      0.85       677
         ORG       0.92      0.91      0.91      1293
         PER       0.98      0.98      0.98      1309

   micro avg       0.94      0.93      0.93      4720
   macro avg       0.93      0.92      0.92      4720
weighted avg       0.94      0.93      0.93      4720

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="show_results"><code>show_results</code><a class="anchor-link" href="#show_results"> </a></h3><p>Below we'll add in additional functionality to more intuitively show the results of our model.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">show_results</span><span class="p">(</span><span class="n">learner</span><span class="o">=</span><span class="n">learn</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">trunc_at</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>token / target label / predicted label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[('"', 'O', 'O'), ('I', 'O', 'O'), ('do', 'O', 'O'), ("n't", 'O', 'O'), ('normally', 'O', 'O'), ('do', 'O', 'O'), ('this', 'O', 'O'), ('but', 'O', 'O'), ('can', 'O', 'O'), ('you', 'O', 'O')]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[('The', 'O', 'O'), ('right-handed', 'O', 'O'), ('batsman', 'O', 'O'), ('will', 'O', 'O'), ('have', 'O', 'O'), ('to', 'O', 'O'), ('forfeit', 'O', 'O'), ('half', 'O', 'O'), ('the', 'O', 'O'), ('money', 'O', 'O')]</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">blurr_predict</span><span class="p">(</span><span class="s2">&quot;My name is Wayde and I live in San Diego&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(&#34;[&#39;O&#39;, &#39;O&#39;, &#39;O&#39;, &#39;O&#39;, &#39;B-PER&#39;, &#39;I-PER&#39;, &#39;O&#39;, &#39;O&#39;, &#39;O&#39;, &#39;O&#39;, &#39;B-LOC&#39;, &#39;I-LOC&#39;, &#39;O&#39;]&#34;,)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="blurr_predict_tokens"><code>blurr_predict_tokens</code><a class="anchor-link" href="#blurr_predict_tokens"> </a></h3><p>The default <code>Learner.predict</code> method returns a prediction per subtoken, including the special tokens for each architecture's tokenizer. Starting with version 2.0 of BLURR, we bring token prediction in-line with Hugging Face's token classification pipeline, both in terms of supporting the same aggregation strategies via Blurr's <a href="/blurr/modeling-token-classification.html#TokenAggregationStrategies"><code>TokenAggregationStrategies</code></a> class, and also the output via BLURR's <code>@patch</code>ed <code>Learner</code> method, <code>blurr_predict_tokens</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TokenAggregationStrategies" class="doc_header"><code>class</code> <code>TokenAggregationStrategies</code><a href="https://github.com/ohmeow/blurr/tree/master/blurr/modeling/token_classification.py#L199" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TokenAggregationStrategies</code>(<strong><code>hf_tokenizer</code></strong>:<code>PreTrainedTokenizerBase</code>, <strong><code>labels</code></strong>:<code>List</code>[<code>str</code>], <strong><code>non_entity_label</code></strong>:<code>str</code>=<em><code>'O'</code></em>)</p>
</blockquote>
<p>Provides the equivalanet of Hugging Face's token classification pipeline's <code>aggregation_strategy</code> support across various
token classication tasks (e.g, NER, POS, chunking, etc...)</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><p><strong><code>hf_tokenizer</code></strong> : <em><code>&lt;class 'transformers.tokenization_utils_base.PreTrainedTokenizerBase'&gt;</code></em></p>
</li>
<li><p><strong><code>labels</code></strong> : <em><code>typing.List[str]</code></em></p>
</li>
<li><p><strong><code>non_entity_label</code></strong> : <em><code>&lt;class 'str'&gt;</code></em>, <em>optional</em></p>
</li>
</ul>
<p><strong>Returns</strong>:</p>
<ul>
<li><em><code>None</code></em></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Learner.blurr_predict_tokens" class="doc_header"><code>Learner.blurr_predict_tokens</code><a href="https://github.com/ohmeow/blurr/tree/master/blurr/modeling/token_classification.py#L286" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Learner.blurr_predict_tokens</code>(<strong><code>items</code></strong>:<code>Union</code>[<code>str</code>, <code>List</code>[<code>str</code>]], <strong><code>aggregation_strategy</code></strong>:<code>str</code>=<em><code>'simple'</code></em>, <strong><code>non_entity_label</code></strong>:<code>str</code>=<em><code>'O'</code></em>, <strong><code>slow_word_ids_func</code></strong>:<code>Optional</code>[<code>Callable</code>]=<em><code>None</code></em>)</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>items</code></strong> : <em><code>typing.Union[str, typing.List[str]]</code></em>    <p>The str (or list of strings) you want to get token classification predictions for</p></li>
</ul>
<ul>
<li><strong><code>aggregation_strategy</code></strong> : <em><code>&lt;class 'str'&gt;</code></em>, <em>optional</em>   <p>How entities are grouped and scored</p></li>
</ul>
<ul>
<li><strong><code>non_entity_label</code></strong> : <em><code>&lt;class 'str'&gt;</code></em>, <em>optional</em>   <p>The label used to idendity non-entity related words/tokens</p></li>
</ul>
<ul>
<li><strong><code>slow_word_ids_func</code></strong> : <em><code>typing.Union[typing.Callable, NoneType]</code></em>, <em>optional</em>   <p>If using a slow tokenizer, users will need to prove a `slow_word_ids_func` that accepts a
tokenizzer, example index, and a batch encoding as arguments and in turn returnes the
equavlient of fast tokenizer's `word_ids``</p></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">blurr_predict_tokens</span><span class="p">(</span>
    <span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;My name is Wayde and I live in San Diego and using Hugging Face&quot;</span><span class="p">,</span> <span class="s2">&quot;Bayern Munich is a soccer team in Germany&quot;</span><span class="p">],</span>
    <span class="n">aggregation_strategy</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2
[{&#39;entity_group&#39;: &#39;ORG&#39;, &#39;score&#39;: 0.9951454997062683, &#39;word&#39;: &#39;Bayern Munich&#39;, &#39;start&#39;: 0, &#39;end&#39;: 13}, {&#39;entity_group&#39;: &#39;LOC&#39;, &#39;score&#39;: 0.9986792206764221, &#39;word&#39;: &#39;Germany&#39;, &#39;start&#39;: 34, &#39;end&#39;: 41}]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;Hi! My name is Wayde Gilliam from ohmeow.com. I live in California.&quot;</span>
<span class="n">txt2</span> <span class="o">=</span> <span class="s2">&quot;I wish covid was over so I could go to Germany and watch Bayern Munich play in the Bundesliga.&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">blurr_predict_tokens</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[[{&#39;entity_group&#39;: &#39;PER&#39;, &#39;score&#39;: 0.9391538500785828, &#39;word&#39;: &#39;Wayde Gilliam&#39;, &#39;start&#39;: 15, &#39;end&#39;: 28}, {&#39;entity_group&#39;: &#39;ORG&#39;, &#39;score&#39;: 0.47220221161842346, &#39;word&#39;: &#39;oh&#39;, &#39;start&#39;: 34, &#39;end&#39;: 36}, {&#39;entity_group&#39;: &#39;ORG&#39;, &#39;score&#39;: 0.5089981555938721, &#39;word&#39;: &#39;ow&#39;, &#39;start&#39;: 38, &#39;end&#39;: 40}, {&#39;entity_group&#39;: &#39;LOC&#39;, &#39;score&#39;: 0.9922611117362976, &#39;word&#39;: &#39;California&#39;, &#39;start&#39;: 56, &#39;end&#39;: 66}]]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">blurr_predict_tokens</span><span class="p">([</span><span class="n">txt</span><span class="p">,</span> <span class="n">txt2</span><span class="p">])</span>
<span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{res}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[{&#39;entity_group&#39;: &#39;PER&#39;, &#39;score&#39;: 0.9391538500785828, &#39;word&#39;: &#39;Wayde Gilliam&#39;, &#39;start&#39;: 15, &#39;end&#39;: 28}, {&#39;entity_group&#39;: &#39;ORG&#39;, &#39;score&#39;: 0.47220221161842346, &#39;word&#39;: &#39;oh&#39;, &#39;start&#39;: 34, &#39;end&#39;: 36}, {&#39;entity_group&#39;: &#39;ORG&#39;, &#39;score&#39;: 0.5089981555938721, &#39;word&#39;: &#39;ow&#39;, &#39;start&#39;: 38, &#39;end&#39;: 40}, {&#39;entity_group&#39;: &#39;LOC&#39;, &#39;score&#39;: 0.9922611117362976, &#39;word&#39;: &#39;California&#39;, &#39;start&#39;: 56, &#39;end&#39;: 66}]

[{&#39;entity_group&#39;: &#39;LOC&#39;, &#39;score&#39;: 0.9983587861061096, &#39;word&#39;: &#39;Germany&#39;, &#39;start&#39;: 39, &#39;end&#39;: 46}, {&#39;entity_group&#39;: &#39;ORG&#39;, &#39;score&#39;: 0.989933043718338, &#39;word&#39;: &#39;Bayern Munich&#39;, &#39;start&#39;: 57, &#39;end&#39;: 70}, {&#39;entity_group&#39;: &#39;MISC&#39;, &#39;score&#39;: 0.9345605373382568, &#39;word&#39;: &#39;Bundesliga&#39;, &#39;start&#39;: 83, &#39;end&#39;: 93}]

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Inference">Inference<a class="anchor-link" href="#Inference"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">export_fname</span> <span class="o">=</span> <span class="s2">&quot;tok_class_learn_export&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{export_fname}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>
<span class="n">inf_learn</span> <span class="o">=</span> <span class="n">load_learner</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{export_fname}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">inf_learn</span><span class="o">.</span><span class="n">blurr_predict_tokens</span><span class="p">([</span><span class="n">txt</span><span class="p">,</span> <span class="n">txt2</span><span class="p">])</span>
<span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{res}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[{&#39;entity_group&#39;: &#39;PER&#39;, &#39;score&#39;: 0.9391539245843887, &#39;word&#39;: &#39;Wayde Gilliam&#39;, &#39;start&#39;: 15, &#39;end&#39;: 28}, {&#39;entity_group&#39;: &#39;ORG&#39;, &#39;score&#39;: 0.47220125794410706, &#39;word&#39;: &#39;oh&#39;, &#39;start&#39;: 34, &#39;end&#39;: 36}, {&#39;entity_group&#39;: &#39;ORG&#39;, &#39;score&#39;: 0.5089980363845825, &#39;word&#39;: &#39;ow&#39;, &#39;start&#39;: 38, &#39;end&#39;: 40}, {&#39;entity_group&#39;: &#39;LOC&#39;, &#39;score&#39;: 0.9922613501548767, &#39;word&#39;: &#39;California&#39;, &#39;start&#39;: 56, &#39;end&#39;: 66}]

[{&#39;entity_group&#39;: &#39;LOC&#39;, &#39;score&#39;: 0.9983586668968201, &#39;word&#39;: &#39;Germany&#39;, &#39;start&#39;: 39, &#39;end&#39;: 46}, {&#39;entity_group&#39;: &#39;ORG&#39;, &#39;score&#39;: 0.9899331629276276, &#39;word&#39;: &#39;Bayern Munich&#39;, &#39;start&#39;: 57, &#39;end&#39;: 70}, {&#39;entity_group&#39;: &#39;MISC&#39;, &#39;score&#39;: 0.9345607757568359, &#39;word&#39;: &#39;Bundesliga&#39;, &#39;start&#39;: 83, &#39;end&#39;: 93}]

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="High-level-API">High-level API<a class="anchor-link" href="#High-level-API"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="BLearnerForTokenClassification"><code>BLearnerForTokenClassification</code><a class="anchor-link" href="#BLearnerForTokenClassification"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BlearnerForTokenClassification" class="doc_header"><code>class</code> <code>BlearnerForTokenClassification</code><a href="https://github.com/ohmeow/blurr/tree/master/blurr/modeling/token_classification.py#L336" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BlearnerForTokenClassification</code>(<strong><code>dls</code></strong>:<code>DataLoaders</code>, <strong><code>hf_model</code></strong>:<code>PreTrainedModel</code>, <strong><code>base_model_cb</code></strong>:<a href="/blurr/modeling-core.html#BaseModelCallback"><code>BaseModelCallback</code></a>=<em><code>BaseModelCallback</code></em>, <strong><code>loss_func</code></strong>=<em><code>None</code></em>, <strong><code>opt_func</code></strong>=<em><code>Adam</code></em>, <strong><code>lr</code></strong>=<em><code>0.001</code></em>, <strong><code>splitter</code></strong>=<em><code>trainable_params</code></em>, <strong><code>cbs</code></strong>=<em><code>None</code></em>, <strong><code>metrics</code></strong>=<em><code>None</code></em>, <strong><code>path</code></strong>=<em><code>None</code></em>, <strong><code>model_dir</code></strong>=<em><code>'models'</code></em>, <strong><code>wd</code></strong>=<em><code>None</code></em>, <strong><code>wd_bn_bias</code></strong>=<em><code>False</code></em>, <strong><code>train_bn</code></strong>=<em><code>True</code></em>, <strong><code>moms</code></strong>=<em><code>(0.95, 0.85, 0.95)</code></em>) :: <a href="/blurr/modeling-core.html#Blearner"><code>Blearner</code></a></p>
</blockquote>
<p>Group together a <code>model</code>, some <code>dls</code> and a <code>loss_func</code> to handle training</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><p><strong><code>dls</code></strong> : <em><code>&lt;class 'fastai.data.core.DataLoaders'&gt;</code></em></p>
</li>
<li><p><strong><code>hf_model</code></strong> : <em><code>&lt;class 'transformers.modeling_utils.PreTrainedModel'&gt;</code></em></p>
</li>
<li><p><strong><code>kwargs</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></p>
</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">BlearnerForTokenClassification</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span>
    <span class="n">conll2003_df</span><span class="p">,</span>
    <span class="s2">&quot;roberta-base&quot;</span><span class="p">,</span>
    <span class="n">tokens_attr</span><span class="o">=</span><span class="s2">&quot;tokens&quot;</span><span class="p">,</span>
    <span class="n">token_labels_attr</span><span class="o">=</span><span class="s2">&quot;ner_tags&quot;</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
    <span class="n">dblock_splitter</span><span class="o">=</span><span class="n">RandomSplitter</span><span class="p">(),</span>
    <span class="n">dl_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bs&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">learn</span><span class="o">.</span><span class="n">unfreeze</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">dls</span><span class="o">.</span><span class="n">show_batch</span><span class="p">(</span><span class="n">dataloaders</span><span class="o">=</span><span class="n">learn</span><span class="o">.</span><span class="n">dls</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>word / target label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[('MARKET', 'O'), ('TALK', 'O'), ('-', 'O'), ('USDA', 'B-ORG'), ('net', 'O'), ('change', 'O'), ('in', 'O'), ('weekly', 'O'), ('export', 'O'), ('commitments', 'O'), ('for', 'O'), ('the', 'O'), ('week', 'O'), ('ended', 'O'), ('August', 'O'), ('22', 'O'), (',', 'O'), ('includes', 'O'), ('old', 'O'), ('crop', 'O'), ('and', 'O'), ('new', 'O'), ('crop', 'O'), (',', 'O'), ('were', 'O'), (':', 'O'), ('wheat', 'O'), ('up', 'O'), ('595,400', 'O'), ('tonnes', 'O'), ('old', 'O'), (',', 'O'), ('nil', 'O'), ('new', 'O'), (';', 'O'), ('corn', 'O'), ('up', 'O'), ('1,900', 'O'), ('old', 'O'), (',', 'O'), ('up', 'O'), ('319,600', 'O'), ('new', 'O'), (';', 'O'), ('soybeans', 'O'), ('down', 'O'), ('12,300', 'O'), ('old', 'O'), (',', 'O'), ('up', 'O'), ('300,800', 'O'), ('new', 'O'), (';', 'O'), ('upland', 'O'), ('cotton', 'O'), ('up', 'O'), ('50,400', 'O'), ('bales', 'O'), ('new', 'O'), (',', 'O'), ('nil', 'O'), ('old', 'O'), (';', 'O'), ('soymeal', 'O'), ('54,800', 'O'), ('old', 'O'), (',', 'O'), ('up', 'O'), ('100,600', 'O'), ('new', 'O'), (',', 'O'), ('soyoil', 'O'), ('nil', 'O'), ('old', 'O'), (',', 'O'), ('up', 'O'), ('75,000', 'O'), ('new', 'O'), (';', 'O'), ('barley', 'O'), ('up', 'O'), ('1,700', 'O'), ('old', 'O'), (',', 'O'), ('nil', 'O'), ('new', 'O'), (';', 'O'), ('sorghum', 'O'), ('6,200', 'O'), ('old', 'O'), (',', 'O'), ('up', 'O'), ('156,700', 'O'), ('new', 'O'), (';', 'O'), ('pima', 'O'), ('cotton', 'O'), ('up', 'O'), ('4,000', 'O'), ('bales', 'O'), ('old', 'O'), (',', 'O'), ('nil', 'O'), ('new', 'O'), (';', 'O'), ('rice', 'O'), ('up', 'O'), ('49,900', 'O'), ('old', 'O'), (',', 'O'), ('nil', 'O'), ('new', 'O'), ('...', 'O')]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[('But', 'O'), ('Nutricia', 'B-ORG'), ('shrugged', 'O'), ('off', 'O'), ('its', 'O'), ('ex-div', 'O'), ('tag', 'O'), ('to', 'O'), ('soar', 'O'), ('a', 'O'), ('further', 'O'), ('4.10', 'O'), ('guilders', 'O'), ('to', 'O'), ('214.40', 'O'), ('continuing', 'O'), ('its', 'O'), ('explosive', 'O'), ('rally', 'O'), ('sparked', 'O'), ('by', 'O'), ('the', 'O'), ('51', 'O'), ('percent', 'O'), ('jump', 'O'), ('in', 'O'), ('first', 'O'), ('half', 'O'), ('net', 'O'), ('profits', 'O'), ('last', 'O'), ('week', 'O'), (',', 'O'), ('which', 'O'), ('set', 'O'), ('the', 'O'), ('market', 'O'), ('alight', 'O'), ('on', 'O'), ('Friday', 'O'), (',', 'O'), ('sending', 'O'), ('the', 'O'), ('shares', 'O'), ('up', 'O'), ('18.40', 'O'), ('at', 'O'), ('210.00', 'O'), ('by', 'O'), ('the', 'O'), ('close', 'O'), ('.', 'O')]</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lr_max</span><span class="o">=</span><span class="mf">3e-5</span><span class="p">,</span> <span class="n">moms</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="n">cbs</span><span class="o">=</span><span class="p">[</span><span class="n">BlearnerForTokenClassification</span><span class="o">.</span><span class="n">get_metrics_cb</span><span class="p">()])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>precision</th>
      <th>recall</th>
      <th>f1</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.054646</td>
      <td>0.052829</td>
      <td>0.987834</td>
      <td>0.933219</td>
      <td>0.927246</td>
      <td>0.930223</td>
      <td>06:11</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">show_results</span><span class="p">(</span><span class="n">learner</span><span class="o">=</span><span class="n">learn</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">trunc_at</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>token / target label / predicted label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[('Hurte', 'B-PER', 'B-PER'), ('Sierd', 'I-PER', 'I-PER'), ('Zylstra', 'I-PER', 'I-PER'), ('and', 'O', 'O'), ('his', 'O', 'O'), ('wife', 'O', 'O'), (',', 'O', 'O'), ('Jetsi', 'B-PER', 'B-PER'), ('Hendrika', 'I-PER', 'I-PER'), ('Coers', 'I-PER', 'I-PER')]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[('Proud', 'O', 'O'), ('of', 'O', 'O'), ('its', 'O', 'O'), ('record', 'O', 'O'), ('in', 'O', 'O'), ('promptly', 'O', 'O'), ('joining', 'O', 'O'), ('both', 'O', 'O'), ('the', 'O', 'O'), ('Council', 'B-ORG', 'B-ORG')]</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">token_classification_report</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>              precision    recall  f1-score   support

         LOC       0.95      0.96      0.96      1412
        MISC       0.85      0.89      0.87       671
         ORG       0.91      0.88      0.89      1330
         PER       0.98      0.96      0.97      1274

   micro avg       0.93      0.93      0.93      4687
   macro avg       0.92      0.92      0.92      4687
weighted avg       0.93      0.93      0.93      4687

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;Hi! My name is Wayde Gilliam from ohmeow.com. I live in California.&quot;</span>
<span class="n">txt2</span> <span class="o">=</span> <span class="s2">&quot;I wish covid was over so I could watch Lewandowski score some more goals for Bayern Munich in the Bundesliga.&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">blurr_predict_tokens</span><span class="p">([</span><span class="n">txt</span><span class="p">,</span> <span class="n">txt2</span><span class="p">])</span>
<span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{res}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[{&#39;entity_group&#39;: &#39;PER&#39;, &#39;score&#39;: 0.9054279625415802, &#39;word&#39;: &#39;Wayde Gilliam&#39;, &#39;start&#39;: 15, &#39;end&#39;: 28}, {&#39;entity_group&#39;: &#39;ORG&#39;, &#39;score&#39;: 0.5879698296387991, &#39;word&#39;: &#39;ohmeow&#39;, &#39;start&#39;: 34, &#39;end&#39;: 40}, {&#39;entity_group&#39;: &#39;LOC&#39;, &#39;score&#39;: 0.998404324054718, &#39;word&#39;: &#39;California&#39;, &#39;start&#39;: 56, &#39;end&#39;: 66}]

[{&#39;entity_group&#39;: &#39;PER&#39;, &#39;score&#39;: 0.8456946611404419, &#39;word&#39;: &#39;cov&#39;, &#39;start&#39;: 7, &#39;end&#39;: 10}, {&#39;entity_group&#39;: &#39;PER&#39;, &#39;score&#39;: 0.9973038733005524, &#39;word&#39;: &#39;Lewandowski&#39;, &#39;start&#39;: 39, &#39;end&#39;: 50}, {&#39;entity_group&#39;: &#39;ORG&#39;, &#39;score&#39;: 0.9921272993087769, &#39;word&#39;: &#39;Bayern Munich&#39;, &#39;start&#39;: 77, &#39;end&#39;: 90}, {&#39;entity_group&#39;: &#39;MISC&#39;, &#39;score&#39;: 0.9669867157936096, &#39;word&#39;: &#39;Bundesliga&#39;, &#39;start&#39;: 98, &#39;end&#39;: 108}]

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Tests">Tests<a class="anchor-link" href="#Tests"> </a></h2><p>The tests below to ensure the token classification training code above works for <strong>all</strong> pretrained token classification models available in Hugging Face.  These tests are excluded from the CI workflow because of how long they would take to run and the amount of data that would be required to download.</p>
<p><strong>Note</strong>: Feel free to modify the code below to test whatever pretrained token classification models you are working with ... and if any of your pretrained token classification models fail, please submit a github issue <em>(or a PR if you'd like to fix it yourself)</em></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">raw_datasets</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;conll2003&quot;</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">raw_datasets</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;ner_tags&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">names</span>
<span class="n">conll2003_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">raw_datasets</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Reusing dataset conll2003 (/home/wgilliam/.cache/huggingface/datasets/conll2003/conll2003/1.0.0/40e7cb6bcc374f7c349c83acd1e9352a4f09474eb691f64f364ee62eb65d0ca6)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>arch</th>
      <th>tokenizer</th>
      <th>model_name</th>
      <th>result</th>
      <th>error</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>albert</td>
      <td>AlbertTokenizerFast</td>
      <td>AlbertForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td>bert</td>
      <td>BertTokenizerFast</td>
      <td>BertForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td>big_bird</td>
      <td>BigBirdTokenizerFast</td>
      <td>BigBirdForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>3</th>
      <td>camembert</td>
      <td>CamembertTokenizerFast</td>
      <td>CamembertForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>4</th>
      <td>convbert</td>
      <td>ConvBertTokenizerFast</td>
      <td>ConvBertForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>5</th>
      <td>deberta</td>
      <td>DebertaTokenizerFast</td>
      <td>DebertaForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>6</th>
      <td>bert</td>
      <td>BertTokenizerFast</td>
      <td>BertForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>7</th>
      <td>electra</td>
      <td>ElectraTokenizerFast</td>
      <td>ElectraForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>8</th>
      <td>funnel</td>
      <td>FunnelTokenizerFast</td>
      <td>FunnelForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>9</th>
      <td>gpt2</td>
      <td>GPT2TokenizerFast</td>
      <td>GPT2ForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>10</th>
      <td>layoutlm</td>
      <td>LayoutLMTokenizerFast</td>
      <td>LayoutLMForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>11</th>
      <td>longformer</td>
      <td>LongformerTokenizerFast</td>
      <td>LongformerForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>12</th>
      <td>mpnet</td>
      <td>MPNetTokenizerFast</td>
      <td>MPNetForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>13</th>
      <td>ibert</td>
      <td>RobertaTokenizerFast</td>
      <td>IBertForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>14</th>
      <td>mobilebert</td>
      <td>MobileBertTokenizerFast</td>
      <td>MobileBertForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>15</th>
      <td>rembert</td>
      <td>RemBertTokenizerFast</td>
      <td>RemBertForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>16</th>
      <td>roformer</td>
      <td>RoFormerTokenizerFast</td>
      <td>RoFormerForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>17</th>
      <td>roberta</td>
      <td>RobertaTokenizerFast</td>
      <td>RobertaForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>18</th>
      <td>squeezebert</td>
      <td>SqueezeBertTokenizerFast</td>
      <td>SqueezeBertForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>19</th>
      <td>xlm_roberta</td>
      <td>XLMRobertaTokenizerFast</td>
      <td>XLMRobertaForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
    <tr>
      <th>20</th>
      <td>xlnet</td>
      <td>XLNetTokenizerFast</td>
      <td>XLNetForTokenClassification</td>
      <td>PASSED</td>
      <td></td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Summary">Summary<a class="anchor-link" href="#Summary"> </a></h2><p>This module includes all the low, mid, and high-level API bits for token classification tasks training and inference.</p>

</div>
</div>
</div>
</div>
 

